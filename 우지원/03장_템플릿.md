# 3ì¥ í…œí”Œë¦¿
1. [ë‹¤ì‹œ ë³´ëŠ” ì´ˆë‚œê° DAO](#31-ë‹¤ì‹œ-ë³´ëŠ”-ì´ˆë‚œê°-dao)
2. [ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ](#32-ë³€í•˜ëŠ”-ê²ƒê³¼-ë³€í•˜ì§€-ì•ŠëŠ”-ê²ƒ)
3. [JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”](#33-jdbc-ì „ëµ-íŒ¨í„´ì˜-ìµœì í™”)
4. [ì»¨í…ìŠ¤íŠ¸ì™€ DI](#34-ì»¨í…ìŠ¤íŠ¸ì™€-di)
5. [í…œí”Œë¦¿ê³¼ ì½œë°±](#35-í…œí”Œë¦¿ê³¼-ì½œë°±)
6. [ìŠ¤í”„ë§ì˜ JDBCTEMPLATE](#36-ìŠ¤í”„ë§ì˜-jdbctemplate)

<br>

## 3.1 ë‹¤ì‹œ ë³´ëŠ” ì´ˆë‚œê° DAO

> **í…œí”Œë¦¿ì´ë€?** <br>
 ë°”ë€ŒëŠ” ì„±ì§ˆì´ ë‹¤ë¥¸ ì½”ë“œ ì¤‘ì—ì„œ ë³€ê²½ì´ ê±°ì˜ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë©° ì¼ì •í•œ íŒ¨í„´ìœ¼ë¡œ ìœ ì§€ë˜ëŠ” íŠ¹ì„±ì„ ê°€ì§„ ë¶€ë¶„ì„  
 ììœ ë¡­ê²Œ ë³€ê²½ë˜ëŠ” ì„±ì§€ë¦‰ã„¹ ê°€ì§„ ë¶€ë¶„ìœ¼ë¡œë¶€í„° ë…ë¦½ì‹œì¼œì„œ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ë°©ë²•ì´ë‹¤.

3ì¥ì—ì„œëŠ” ìŠ¤í”„ë§ì— ì ìš©ëœ í…œí”Œë¦¿ ê¸°ë²•ì„ ì‚´í´ë³´ê³  dao ì½”ë“œë¥¼ ê°œì„ ì‹œì¼œë³´ì~

### ğŸƒ ì˜ˆì™¸ì²˜ë¦¬ ê¸°ëŠ¥ì„ ê°–ì¶˜ DAO
DB ì»¤ë„¥ì…˜ì´ë¼ëŠ” ì œí•œì ì¸ ë¦¬ì†ŒìŠ¤ë¥¼ ê³µìœ í•´ ì‚¬ìš©í•˜ëŠ” ì„œë²„ì—ì„œ ë™ì‘í•˜ëŠ” JDBC ì½”ë“œì—ëŠ”
ë°˜ë“œì‹œ ì§€ì¼œì•¼í•  ì›ì¹™ì´ ìˆë‹¤!!! ë°”ë¡œ **ì˜ˆì™¸ì²˜ë¦¬**ì´ë‹¤.

- ê¸°ì¡´ DAO ì½”ë“œì˜ deleteAll()
```java
public void deleteAll() throws SQLException{
	Connection c = dataSource.getConnection();

	//ì—¬ê¸°ì— ìˆëŠ” 2ì¤„ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ë°”ë¡œ ë©”ì†Œë“œ ì‹¤í–‰ì´ ì¤‘ë‹¨ëœë‹¤.
	PreparedStatement ps = c.prepareStatement("delete from users");
	ps.executeUpdate();

	ps.close();
	c.close();
}
```
ì¼ë°˜ì ìœ¼ë¡œ ì„œë²„ì—ì„œëŠ” ì œí•œëœ ê°œìˆ˜ì˜ DB ì»¤ë„¥ì…˜ì„ ë§Œë“¤ì–´ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ í’€ë¡œ ê´€ë¦¬í•œë‹¤.  
DB í’€ì€ ë§¤ë²ˆ getConnection()ìœ¼ë¡œ ê°€ì ¸ê°„ ì»¤ë„¥ì…˜ì„ ëª…ì‹œì ìœ¼ë¡œ close() í•´ì„œ ëŒë ¤ì¤˜ì•¼ì§€ë§Œ ë‹¤ì‹œ í’€ì— ë„£ì—ˆë‹¤ê°€ ë‹¤ìŒ ì»¤ë„¥ì…˜ ìš”ì²­ì´ ìˆì„ ë•Œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  

But, ì˜¤ë¥˜ê°€ ë‚ ë•Œë§ˆë‹¤ ë°˜í™˜ë˜ì§€ ëª»í•œ Connectionì´ ê³„ì† ìŒ“ì´ë©´ ì–´ëŠìˆœê°„ ì»¤ë„¥ì…˜ í’€ì— ì—¬ìœ ê°€ ì—†ì–´ì§€ê³  ë¦¬ì†ŒìŠ¤ê°€ ëª¨ìë€ë‹¤ëŠ” ì‹¬ê°í•œ ì˜¤ë¥˜ë¥¼ ë‚´ë©° ì„œë²„ ì¤‘ë‹¨ë  ìˆ˜ë„ ìˆë‹¤!  
ìœ„ì˜ ì½”ë“œëŠ” ì¥ì‹œê°„ ìš´ì˜ë˜ëŠ” ë‹¤ì¤‘ ì‚¬ìš©ìë¥¼ìœ„í•œ ì„œë²„ì— ì ìš©í•˜ê¸°ì—ëŠ” ì¹˜ëª…ì ì¸ ìœ„í—˜ì„ ë‚´í¬í•œë‹¤.  

> **ë¦¬ì†ŒìŠ¤ ë°˜í™˜ê³¼ close()** <br>
 Connectionê³¼ PreparedStatementëŠ” ë³´í†µ í’€ë°©ì‹ìœ¼ë¡œ ìš´ì˜ëœë‹¤. 
 ë¯¸ë¦¬ ì •í•´ì§„ í’€ì•ˆì— ì œí•œëœ ìˆ˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë§Œë“¤ì–´ ë‘ê³ , í•„ìš”í•  ë•Œ í• ë‹¹í•˜ê³  ë°˜í™˜í•˜ë©´ ë‹¤ì‹œ í’€ì— ë„£ëŠ” ë°©ì‹ìœ¼ë¡œ ìš´ì˜ëœë‹¤.   
 ìš”ì²­ì´ ë§¤ìš° ë§ì€ ì„œë²„í™˜ê²½ì—ì„œëŠ” ë§¤ë²ˆ ìƒˆë¡œìš´ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ëŒ€ì‹  í’€ì— ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘” ë¦¬ì†ŒìŠ¤ë¥¼ ëŒë ¤ê°€ë©° ì‚¬ìš©í•˜ëŠ” í¸ì´ í›¨ì”¬ ìœ ë¦¬í•˜ë‹¤.   
 ëŒ€ì‹  ì‚¬ìš©í•œ ë¦¬ì†ŒìŠ¤ëŠ” ë¹ ë¥´ê²Œ ë°˜í™˜í•´ì•¼í•˜ë©° ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ í’€ì— ìˆëŠ” ë¦¬ì†ŒìŠ¤ê°€ ê³ ê°ˆë˜ê³  ë¬¸ì œê°€ ë°œìƒí•œë‹¤.   
 close()ëŠ” ì‚¬ìš©í•œ ë¦¬ì†ŒìŠ¤ë¥¼ í’€ë¡œ ë‹¤ì‹œ ëŒë ¤ì£¼ëŠ” ì—­í• ì„ í•œë‹¤.

- try/catch/finallyë¥¼ í†µí•´ ì˜ˆì™¸ë°œìƒì‹œ ë¦¬ì†ŒìŠ¤ ë°˜í™˜í•˜ëŠ” deleteAll()
```java
public void deleteAll() throws SQLException {
    Connection c = null;
    PreparedStatement ps = null;
    
    try {
        c = dataSource.getConnection();
        ps = c.prepareStatement("delete from users");
        ps.executeUpdate();     //  ì˜ˆì™¸ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì½”ë“œë¥¼ ëª¨ë‘ try ë¸”ë¡ìœ¼ë¡œ ë¬¶ì–´ì¤€ë‹¤.
    } catch (SQLException e) {
        throw e;        //  ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë•Œ ë¶€ê°€ì ì¸ ì‘ì—…ì„ í•´ì¤„ ìˆ˜ ìˆë„ë¡ catch ë¸”ë¡ì„ ë‘”ë‹¤. ì•„ì§ì€ ì˜ˆì™¸ë¥¼ ë©”ì†Œë“œ ë°–ìœ¼ë¡œ ë˜ì§€ëŠ” ê²ƒ ë°–ì— ì—†ë‹¤.
    } finally {         //  finallyì´ë¯€ë¡œ try ë¸”ë¡ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆì„ ë–„ë‚˜ ì•ˆ í–ˆì„ ë•Œë‚˜ ëª¨ë‘ ì‹¤í–‰ëœë‹¤.
        if (ps != null) {  //ì–´ëŠ ì‹œì ì—ì„œ ì˜ˆì™¸ê°€ ë°œìƒí–ˆëŠ”ì§€ì— ë”°ë¼ì„œ close()ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë³€ìˆ˜ê°€ ë‹¬ë¼ì§ -> null í™•ì¸ í›„ close();
            try {
                ps.close();
            } catch (SQLException e) {} //  ps.close() ë©”ì†Œë“œì—ì„œë„ SQLExceptionì´ ë°£ìƒí•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì¡ì•„ì¤˜ì•¼í•œë‹¤.
        }
        if (c != null) {
            try {
                c.close();
            } catch (SQLException e) {}
        }
    }
}
```
<br>

## 3.2 ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒ

### ğŸƒ JDBC try/catch/finally ì½”ë“œì˜ ë¬¸ì œì 
- ë³µì¡í•œ try/catch/finally ë¸”ë¡ì´ 2ì¤‘ ì¤‘ì²©, ëª¨ë“  ë©”ì†Œë“œë§ˆë‹¤ ë°˜ë³µ
- ë³µì‚¬ ë¶™ì—¬ ë„£ê¸° í•˜ê³  -> try ë¶€ë¶„ë§Œ ì†ë³´ê³ ... -> ê·¼ë° ì˜ëª» ë³µë¶™í•˜ê±°ë‚˜ ì‚­ì œí•¨ -> ì„œë¹„ìŠ¤ ì¤‘ë‹¨..

- ì´ ë¬¸ì œì˜ í•µì‹¬ì€, ë³€í•˜ì§€ ì•ŠëŠ”, ê·¸ëŸ¬ë‚˜ ë§ì€ ê³³ì—ì„œ ì¤‘ë³µë˜ëŠ” ì½”ë“œì™€ ë¡œì§ì— ë”°ë¼ ìê¾¸ í™•ì¥ë˜ê³  ìì£¼ ë³€í•˜ëŠ” ì½”ë“œë¥¼ ì˜ ë¶„ë¦¬í•´ë‚´ëŠ” ì‘ì—…ì´ë‹¤.

### ğŸƒ ë¶„ë¦¬ì™€ ì¬ì‚¬ìš©ì„ ìœ„í•œ ë””ìì¸ íŒ¨í„´ ì ìš©
í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì„ ì´ìš©í•´ì„œ ë¶„ë¦¬í•´ë³´ì!  
í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ì€ ìƒì†ì„ í†µí•´ ê¸°ëŠ¥ì„ í™•ì¥í•´ì„œ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì´ë‹¤. ë³€í•˜ì§€ ì•ŠëŠ” ë¶€ë¶„ì€ ìŠˆí¼í´ë˜ìŠ¤ì— ë‘ê³  ë³€í•˜ëŠ” ë¶€ë¶„ì€ ì¶”ìƒ ë©”ì†Œë“œë¡œ ì •ì˜í•´ë‘¬ì„œ ì„œë¸Œí´ë˜ìŠ¤ì—ì„œ ì˜¤ë²„ë¼ì´ë“œí•˜ì—¬ ìƒˆë¡­ê²Œ ì •ì˜í•´ ì“°ë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.

ì¶”ì¶œí•´ì„œ ë³„ë„ì˜ ë©”ì†Œë“œë¡œ ë…ë¦½ì‹œí‚¨ makeStatement()ë©”ì†Œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì¶”ìƒë©”ì†Œë“œ ì„ ì–¸ìœ¼ë¡œ ë³€ê²½í•œë‹¤. ë¬¼ë¡  UserDaoí´ë˜ìŠ¤ë„ ì¶”ìƒí´ë˜ìŠ¤ê°€ ë¼ì•¼í•œë‹¤.
```java
abstract protected PreparedStatement makeStatement(Connection c) throws SQLException;
```
ê·¸ë¦¬ê³  ì´ê±¸ ìƒì†í•˜ëŠ” ì„œë¸Œ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ê±°ê¸°ì„œ ì´ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•œë‹¤.  

- makeStatement()ë¥¼ êµ¬í˜„í•œ UserDao ì„œë¸Œí´ë˜ìŠ¤
```java
public class UserDatoDeleteAll extends UserDao{
    protected PreparedStatement makeStatement(Connection c) throws SQLException {
        prepareStatement ps = c.prepareStatement("delete from users");
        return ps;
    }
}
```
í•˜ì§€ë§Œ ì´ ë°©ì‹ì€ ì ‘ê·¼ì˜ ì œí•œì´ ìˆë‹¤. DAO ë¡œì§ë§ˆë‹¤ ìƒì†ì„ í†µí•´ ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤ëŠ” ì ì´ ê°€ì¥ í° ë¬¸ì œ!   
UserDaoì˜ JDBC ë©”ì†Œë“œê°€ 4ê°œì¼ ê²½ìš° 4ê°œì˜ ì„œë¸Œí´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì„œ ì‚¬ìš©í•´ì•¼í•œë‹¤ëŠ” ë‹¨ì ì´ë‹¤.   
ë˜, í™•ì¥ êµ¬ì¡°ê°€ ì´ë¯¸ í´ë˜ìŠ¤ë¥¼ ì„¤ê³„í•˜ëŠ” ì‹œì ì—ì„œ ê³ ì •ë˜ì–´ ë²„ë¦°ë‹¤.   


ê·¸ë ‡ë‹¤ë©´, ì „ëµíŒ¨í„´ì„ ì ìš©í•´ë³´ì!

#### ì „ëµíŒ¨í„´ì˜ ì ìš©
> **ì „ëµíŒ¨í„´ì´ë€?**<br> 
 ocpë¥¼ ì§€í‚¤ë©´ì„œ í…œí”Œë¦¿ ë©”ì†Œë“œ íŒ¨í„´ë³´ë‹¤ ìœ ì—°í•˜ê³  í™•ì¥ì„±ì´ ë›°ì–´ë‚œ ê²ƒì€, ì˜¤ë¸Œì íŠ¸ë¥¼ ì•„ì˜ˆ ë‘˜ë¡œ ë¶„ë¦¬í•˜ê³  í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ì„œë§Œ ì˜ì¡´í•˜ë„ë¡ ë§Œë“œëŠ” ì „ëµ íŒ¨í„´ì´ë‹¤.   

1. DB ì»¤ë„¥ì…˜ ê°€ì ¸ì˜¤ê¸°
2. PreparedStatementë¥¼ ë§Œë“¤ì–´ì¤„ ì™¸ë¶€ ê¸°ëŠ¥ í˜¸ì¶œí•˜ê¸° => ì´ ë¶€ë¶„ì´ ì „ëµíŒ¨í„´ì—ì„œ ë§í•˜ëŠ” ì „ëµì„!!!
3. ì „ë‹¬ ë°›ì€ PreparedStatement ì‹¤í–‰í•˜ê¸°
4. ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ ì´ë¥¼ ë‹¤ì‹œ ë©”ì†Œë“œ ë°–ìœ¼ë¡œ ë˜ì§€ê¸°
5. ëª¨ë“  ê²½ìš°ì— ë§Œë“¤ì–´ì§„ PreparedStatementì™€ Connectionì„ ì ì ˆíˆ ë‹«ì•„ì£¼ê¸°  

<br>

- ì „ëµ íŒ¨í„´ì˜ êµ¬ì¡°ë¥¼ ë”°ë¼ ë§Œë“  StatementStrategy ì¸í„°í˜ì´ìŠ¤
```java
public interface StatementStrategy{
    PreparedStatement makePreparedStatement(Connection c) throws SQLException;
}
```
- ìœ„ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì†í•¨
```java
public class DeleteAllStatement implements StatementStrategy{
    public PreparedStatement makePreparedStatement(Connection c) throws SQLException{
        PreparedStatement ps = c.prepareStatement("delete from users");
        return ps;
    }
}
```

- ì „ëµíŒ¨í„´ì„ ë”°ë¼ ì™„ì„±ëœ deleteAll() ë©”ì†Œë“œ
```java
public void deleteAll throws SQLException {
    ...
    try {
        c = dataSource.getConnection();

        StatementStrategy StatementStrategy = new DeleteAllStatement();
        ps = strategy.makePreparedStatement(c);

        ps.executeUpdate();
    } catch (SQLException E){
        ...
    }
}
```
í•˜ì§€ë§Œ ì´ ì½”ë“œë„ ë¬¸ì œê°€ ì¡´ì¬í•œë‹¤.   
ì»¨í…ìŠ¤íŠ¸ ì•ˆì—ì„œ ì´ë¯¸ êµ¬ì²´ì ì¸ ì „ëµí´ë˜ìŠ¤ì¸ DeleteAllStatement ì‚¬ìš©í•˜ë„ë¡ ê³ ì •ë˜ì–´ ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.   

#### DI ì ìš©ì„ ìœ„í•œ í´ë¼ì´ì–¸íŠ¸/ì»¨í…ìŠ¤íŠ¸ ë¶„ë¦¬ 
í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° StatementStrategy íƒ€ì…ì˜ ì „ëµ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µë°›ê³ ,   
jdbc try/catch/finally êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì§„ ì»¨í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤.   
ì œê³µë°›ì€ ì „ëµ ì˜¤ë¸Œì íŠ¸ëŠ” PreparedStatement ìƒì„±ì´ í•„ìš”í•œ ì‹œì ì— í˜¸ì¶œí•´ì„œ ì‚¬ìš©í•œë‹¤.   

í´ë¼ì´ì–¸íŠ¸ í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ì—ì„œëŠ”, í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ ,   
ì»¨í…ìŠ¤íŠ¸ë¡œ ë¶„ë¦¬í•œ jdbcContextWithStatementStrategy() ë©”ì†Œë¥´ë¥¼ í˜¸ì¶œí•´ì£¼ë©´ ëœë‹¤.!

<br>

## 3.3 JDBC ì „ëµ íŒ¨í„´ì˜ ìµœì í™”
### ğŸƒ ì „ëµ í´ë˜ìŠ¤ì˜ ì¶”ê°€ ì •ë³´
- User ì •ë³´ë¥¼ ìƒì„±ìë¡œë¶€í„° ì œê³µë°›ë„ë¡ ë§Œë“  AddStatement
```java
public class AddStatement implements StatementStrategy {
    User user;
    
    public AddStatement(User user){
        this.user = user; // í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° User íƒ€ì… ì˜¤ë¸Œì íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë„ë¡ ìƒì„±ìë¥¼ í†µí•´ ì œê³µë°›ì.
    }

    public PreparedStatement makePreparedStatement(Connection c){
        ....
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        ....
    }
}
```

- user ì •ë³´ë¥¼ AddStatementì— ì „ë‹¬í•´ì£¼ëŠ” add() ë©”ì†Œë“œ
```java
public void add(User user) throws SQLException {
    StatementStrategy st = new AddStatement(user);
    jdbcContextWithStatementStrategy(st);
}
```

### ğŸƒ ì „ëµê³¼ í´ë¼ì´ì–¸íŠ¸ì˜ ë™ê±°
í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì .  
1. Dao ë©”ì†Œë“œë§ˆë‹¤ ìƒˆë¡œìš´ StatementStrategy êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì•¼ ë¨.
2. ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬ ë°›ëŠ” ìƒì„±ìì™€ ì´ë¥¼ ì €ì¥í•´ë‘˜ ì¸ìŠ¤í„´ìŠ¤ ë³€ìˆ˜ë¥¼ ë²ˆê±°ë¡­ê²Œ ë§Œë“¤ì–´ì•¼ë¨.

#### ë¡œì»¬ í´ë˜ìŠ¤
ë¡œì»¬ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ë³´ì.

- add() ë©”ì†Œë“œ ë‚´ì˜ ë¡œì»¬ í´ë˜ìŠ¤ë¡œ ì´ì „í•œ AddStatement
```java
public void add(User user) throws SQLException {
    class AddStatement implements StatementStrategy {//add() ë©”ì†Œë“œ ë‚´ë¶€ì— ì„ ì–¸ëœ ë¡œì»¬í´ë˜ìŠ¤!!!!
        User user;
    
        public AddStatement(User user){
            this.user = user; 
        }

        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?,?,?)");
            ps.setString(1, user.getId());
            ps.setString(2, user.getName());
            ps.setString(3, user.getPassword());
            
            return ps;
        }

        StatementStrategy st = new AddStatement(user);
        jdbcContextWithStatementStrategy(st);
    }
}
```
- ë¦¬íŒ©í† ë§ : add() ë©”ì†Œë“œì˜ ë¡œì»¬ ë³€ìˆ˜ë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ë„ë¡ ìˆ˜ì •
```java
public void add(final User user) throws SQLException {
    class AddStatement implements StatementStrategy {

        public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
            PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?,?,?)");
            ps.setString(1, user.getId());
            ps.setString(2, user.getName());
            ps.setString(3, user.getPassword());
            
            return ps;
        }

        StatementStrategy st = new AddStatement(); // ìƒì„±ì íŒŒë¼ë¯¸í„°ë¡œ userë¥¼ ì „ë‹¬í•˜ì§€ ì•Šì•„ë„ ëœë‹¤!
        jdbcContextWithStatementStrategy(st);
    }
}
```
> **ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤**<br>
 ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ëŠ” ì´ë¦„ì„ ê°–ì§€ ì•ŠëŠ” í´ë˜ìŠ¤ë‹¤. í´ë˜ìŠ¤ ì„ ì–¸ê³¼ ì˜¤ë¸Œì íŠ¸ ìƒì„±ì´ ê²°í•©ëœ í˜•íƒœë¡œ ë§Œë“¤ì–´ì§€ë©°,   
 ìƒì†í•  í´ë˜ìŠ¤ë‚˜ êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤ë¥¼ ìƒì„±ì ëŒ€ì‹  ì‚¬ìš©í•´ì„œ ë‹¤ìŒê³¼ ê°™ì€ í˜•íƒœë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•œë‹¤.   
 í´ë˜ìŠ¤ë¥¼ ì¬ì‚¬ìš©í•  í•„ìš”ê°€ ì—†ê³ , êµ¬í˜„í•œ ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ê²½ìš°ì— ìœ ìš©í•˜ë‹¤.  
 ```java
 new ì¸í„°í˜ì´ìŠ¤ì´ë¦„(){í´ë˜ìŠ¤ ë³¸ë¬¸};
 ```

- AddStatementë¥¼ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ì „í™˜
```java
StatementStrategy st = new StatementStrategy {

    public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
        PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?,?,?)");
        ps.setString(1, user.getId());
        ps.setString(2, user.getName());
        ps.setString(3, user.getPassword());
        
        return ps;
    }
};
```
- ë©”ì†Œë“œ íŒŒë¼ë¯¸í„°ë¡œ ì´ì „í•œ ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤
```java
public void add(final User user) throws SQLException {
    jdbcContextWithStatementStrategy {
        new StatementStrategy(){
            public PreparedStatement makePreparedStatement(Connection c) throws SQLException {
                PreparedStatement ps = c.prepareStatement("insert into users(id, name, password) values(?,?,?)");
                ps.setString(1, user.getId());
                ps.setString(2, user.getName());
                ps.setString(3, user.getPassword());
                
                return ps;
            }
        }
    };
}
```
<br>

## 3.4 ì»¨í…ìŠ¤íŠ¸ì™€ DI
### ğŸƒ JdbcContextì˜ ë¶„ë¦¬
ì „ëµ íŒ¨í„´ì˜ êµ¬ì¡°ë¡œ ë³´ë©´ UserDao ì˜ ë©”ì†Œë“œê°€ í´ë¼ì´ì–¸íŠ¸ê³ ,   
ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ê²ƒì´ ê°œë³„ì ì¸ ì „ëµì´ê³ ,   
jdbcContextWithStatementStrategy() ë©”ì†Œë“œëŠ” ì»¨í…ìŠ¤íŠ¸ë‹¤.   


í•˜ì§€ë§Œ jdbcContextWithStatementStrategyëŠ” ë‹¤ë¥¸ daoì—ì„œë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë¯€ë¡œ UserDao í´ë˜ìŠ¤ ë°–ìœ¼ë¡œ ë…ë¦½ì‹œì¼œë³´ì!

### ğŸƒ JdbcContextì˜ íŠ¹ë³„í•œ DI
UserDaoëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ê±°ì¹˜ì§€ ì•Šê³  ì½”ë“œì—ì„œ ë°”ë¡œ JdbcContext í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.   
UserDaoì™€ JdbcContextëŠ” í´ë˜ìŠ¤ ë ˆë²¨ì—ì„œ ì˜ì¡´ê´€ê³„ê°€ ê²°ì •ëœë‹¤. ë¹„ë¡ ëŸ°íƒ€ì„ ì‹œì— di ë°©ì‹ìœ¼ë¡œ ì™¸ë¶€ì—ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…í•´ì£¼ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸´ í–ˆì§€ë§Œ, 
ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì˜ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë³€ê²½í•  ìˆ˜ëŠ” ì—†ë‹¤.   

#### ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ DI
ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ìš©í•´ì„œ í´ë˜ìŠ¤ë¥¼ ììœ ë¡­ê²Œ ë³€ê²½í•  ìˆ˜ ìˆê²Œ í•˜ì§€ëŠ” ì•Šì•˜ì§€ë§Œ,   
JdbcContextë¥¼ UserDaoì™€ DI êµ¬ì¡°ë¡œ ë§Œë“¤ì–´ì•¼í•˜ëŠ” ì´ìœ ëŠ”?   

1. JdbcContext ê°€ ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆì˜ ì‹±ê¸€í†¤ ë ˆì§€ìŠ¤í¬ë¦¬ì—ì„œ ê´€ë¦¬ë˜ëŠ” ì‹±ê¸€í†¤ ë¹ˆì´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.
2. JdbcContextê°€ DIë¥¼ í†µí•´ ë‹¤ë¥¸ë¹ˆì— ì˜ì¡´í•˜ê³  ìˆê¸° ë•Œë¬¸ì´ë‹¤.
=> 2ì—ì„œ JdbcContextëŠ” dataSource í”„ë¡œí¼í‹°ë¥¼ í†µí•´ì„œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì£¼ì…ë°›ë„ë¡ ë˜ì–´ìˆë‹¤.
dië¥¼ ìœ„í•´ì„œëŠ” ì£¼ì…ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ì™€ ì£¼ì…ë°›ëŠ” ì˜¤ë¸Œì íŠ¸ ì–‘ìª½ ëª¨ë‘ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ì–´ì•¼ í•œë‹¤.   


#### ì½”ë“œë¥¼ ì´ìš©í•˜ëŠ” ìˆ˜ë™ DI   
JdbcContextë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ UserDaoì— dií•˜ëŠ” ëŒ€ì‹  UserDao ë‚´ë¶€ì—ì„œ ì§ì ‘ dië¥¼ ì ìš©í•˜ëŠ” ë°©ë²•ì´ ìˆë‹¤.   


JdbcContextë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ëˆ„êµ°ê°€ê°€ JdbcContextì˜ ìƒì„±ê³¼ ì´ˆê¸°í™”ë¥¼ ì±…ì„ì ¸ì•¼í•œë‹¤.   
ê·¸ ì œì–´ê¶Œì€ UserDaoê°€ ê°–ëŠ” ê²ƒì´ ì ë‹¹í•˜ë‹¤. ë˜ UserDaoì—ê²Œ diê¹Œì§€ ë§¡ê¸°ëŠ” ê²ƒì´ë‹¤.   
JdbcContextì— ì£¼ì…í•´ì¤„ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ì¸ DataSourceëŠ” UserDaoê°€ ëŒ€ì‹  DI ë°›ë„ë¡ í•˜ë©´ ëœë‹¤.   

1. ì„¤ì •íŒŒì¼ì—ì„œ jdbcContext ë¹ˆì„ ì œê±°í•˜ê³ 
2. ì½”ë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•œë‹¤.


- JdbcContext ìƒì„±ê³¼ DIì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” setDataSource() ë©”ì†Œë“œ
```java
public class UserDao {
    ...
    private JdbcContext jdbcContext;

    public void setDataSource(DataSource dataSource){ // ìˆ˜ì •ì ë©”ì†Œë“œì´ë©´ì„œ jdbccontextì— ëŒ€í•œ ìƒì„±, diì‘ì—…ì„ ë™ì‹œì— ìˆ˜í–‰
        this.jdbcContext = new JdbcContext(); // JdbcContext ìƒì„±(IoC)

        this.jdbcContext.setDataSource(dataSource);//ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ ì£¼ì… di

        this.dataSource = dataSource;//ì•„ì§ JdbcContextë¥¼ ì ìš©í•˜ì§€ ì•Šì€ ë©”ì†Œë“œë¥¼ ìœ„í•´ ì €ì¥í•´ë‘ 
    }
}
```

<br>

## 3.5 í…œí”Œë¦¿ê³¼ ì½œë°±
ë³µì¡í•˜ì§€ë§Œ ë°”ë€Œì§€ ì•ŠëŠ” ì¼ì •í•œ íŒ¨í„´ì„ ê°–ëŠ” ì‘ì—… íë¦„ì´ ì¡´ì¬í•˜ê³  ê·¸ì¤‘ ì¼ë¶€ë¶„ë§Œ ìì£¼ ë°”ê¿”ì„œ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ì— ì í•©í•œ êµ¬ì¡°ë‹¤.   
ì „ëµíŒ¨í„´ì˜ ê¸°ë³¸ êµ¬ì¡°ì— ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¥¼ í™œìš©í•œ ë°©ì‹ì´ë‹¤. ì´ëŸ° ë°©ì‹ì„ ìŠ¤í”„ë§ì—ì„œëŠ” í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì´ë¼ê³  ë¶€ë¥¸ë‹¤.   
ì „ëµ íŒ¨í„´ì˜ ì»¨í…ìŠ¤íŠ¸ë¥¼ í…œí”Œë¦¿ì´ë¼ ë¶€ë¥´ê³ , ìµëª… ë‚´ë¶€ í´ë˜ìŠ¤ë¡œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì½œë°±ì´ë¼ê³  ë¶€ë¥¸ë‹¤.   

> **ì½œë°±** <br> 
 ì½œë°±ì€ ì‹¤í–‰ë˜ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œì— ì „ë‹¬ë˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ë§í•œë‹¤. 
 íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ë˜ì§€ë§Œ ê°’ì„ ì°¸ì¡°í•˜ê¸° ìœ„í•œ ê²ƒì´ ì•„ë‹ˆë¼ íŠ¹ì • ë¡œì§ì„ ë‹´ì€ ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. 
 ìë°”ì—ì„œëŠ” ë©”ì†Œë“œ ìì²´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬í•  ë°©ë²•ì€ ì—†ê¸° ë•Œë¬¸ì— ë©”ì†Œë“œê°€ ë‹´ê¸° ì˜¤ë¸Œì íŠ¸ë¥¼ ì „ë‹¬í•´ì•¼ í•œë‹¤. 
 ê·¸ë˜ì„œ í‘ì…”ë„ ì˜¤ë¸Œì íŠ¸ë¼ê³ ë„ í•œë‹¤.

### ğŸƒ í…œí”Œë¦¿/ì½œë°±ì˜ ë™ì‘ì›ë¦¬
#### í…œí”Œë¦¿/ì½œë°±ì˜ íŠ¹ì§•
1. í´ë¼ì´ì–¸íŠ¸ì˜ ì—­í• ì€ í…œí”Œë¦¿ ì•ˆì—ì„œ ì‹¤í–‰ë  ë¡œì§ì„ ë‹´ì€ ì½œë°± ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ê³ , 
ì½œë°±ì´ ì ì¡°í•  ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ë‹¤. ë§Œë“¤ì–´ì§„ ì½œë°±ì€ í´ë¼ì´ì–¸íŠ¸ê°€ í…œí”Œë¦¿ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ëœë‹¤.  
2. í…œí”Œë¦¿ì€ ì •í•´ì§„ ì‘ì—… íë¦„ì„ ë”°ë¼ ì‘ì—…ì„ ì§„í–‰í•˜ë‹¤ê°€ ë‚´ë¶€ì—ì„œ ìƒì„±í•œ ì°¸ì¡°ì •ë³´ë¥¼ ê°€ì§€ê³  ì½œë°± ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œë‹¤. 
ì½œë°±ì„ í´ë¼ì´ì–¸íŠ¸ ë©”ì†Œë“œì— ìˆëŠ” ì •ë³´ì™€ í…œí”Œë¦¿ì´ ì œê³µí•œ ì°¸ì¡°ì •ë³´ë¥¼ ì´ìš©í•´ì„œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³  ê·¸ ê²°ê³¼ë¥¼ ë‹¤ì‹œ í…œí”Œë¦¿ì— ëŒë ¤ì¤€ë‹¤. 
3. í…œí”Œë¦¿ì€ ì½œë°±ì´ ëŒë ¤ì¤€ ì •ë³´ë¥¼ ì‚¬ìš©í•´ì„œ ì‘ì—…ì„ ë§ˆì € ìˆ˜í–‰í•œë‹¤. ê²½ìš°ì— ë”°ë¼ ìµœì¢… ê²°ê³¼ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë‹¤ì‹œ ëŒë ¤ì£¼ê¸°ë„ í•œë‹¤. 

### ğŸƒ í¸ë¦¬í•œ ì½œë°±ì˜ ì¬í™œìš©
#### ì½œë°±ì˜ ë¶„ë¦¬ì™€ ì¬í™œìš©
ë³€í•˜ëŠ” ê²ƒê³¼ ë³€í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ë¶„ë¦¬í•˜ê³  ë³€í•˜ì§€ ì•ŠëŠ” ê±´ ìœ ì—°í•˜ê²Œ ì¬í™œìš©í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤ëŠ” ê°„ë‹¨í•œ ì›ë¦¬ë¥¼ 
ê³„ì† ì ìš©í–ˆì„ ë•Œ ë‹¨ìˆœí•˜ë©´ì„œë„ ì•ˆì „í•˜ê²Œ ì‘ì„± ê°€ëŠ¥í•œ jdbc í™œìš© ì½”ë“œê°€ ì™„ì„±ëœë‹¤.   

### ğŸƒ í…œí”Œë¦¿/ì½œë°±ì˜ ì‘ìš©
í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì€ ìŠ¤í”„ë§ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ê±°ë‚˜ ìŠ¤í”„ë§ë§Œì´ ì œê³µí•´ì£¼ëŠ” ë…ì ì ì¸ ê¸°ìˆ ì€ ì•„ë‹ˆë‹¤.   
í•˜ì§€ë§Œ ìŠ¤í”„ë§ë§Œí¼ ì´ íŒ¨í„´ì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” í”„ë ˆì„ì›Œí¬ëŠ” ì—†ë‹¤.   

1. ê³ ì •ëœ ì‘ì—…íë¦„ì„ ê°–ê³  ìˆìœ¼ë©´ì„œ ìì£¼ ë°˜ë³µë˜ëŠ” ì½”ë“œê°€ ìˆë‹¤ë©´ ì¤‘ë³µë˜ëŠ” ì½”ë“œë¥¼ ë¶„ë¦¬í•  ë°©ë²•ì„ ìƒê°í•´ë³´ì.
2. ì¤‘ë³µëœ ì½”ë“œëŠ” ë¨¼ì € ë©”ì†Œë“œë¡œ ë¶„ë¦¬í•˜ëŠ” ê°„ë‹¨í•œ ì‹œë„ë¥¼ í•´ë³¸ë‹¤. 
3. ê·¸ì¤‘ ì¼ë¶€ ì‘ì—…ì„ í•„ìš”ì— ë”°ë¼ ë°”ê¾¸ì–´ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì‚¬ì´ì— ë‘ê³  ë¶„ë¦¬í•´ì„œ ì „ëµíŒ¨í„´ì„ ì ìš©í•˜ê³  
dië¡œ ì´ì¡´ê´€ê³„ë¥¼ ê´€ë¦¬í•˜ë„ë¡í•œë‹¤.
4. ë§Œì•½, ë§ˆë€ŒëŠ” ë¶€ë¶„ì´ ì—¬ëŸ¬ì¢…ë¥˜ê°€ ë§Œë“¤ì–´ì§ˆ ìˆ˜ ìˆë‹¤ë©´ í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì„ ì ìš©í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•´ë³¸ë‹¤.  


ê°€ì¥ ì „í˜•ì ì¸ í…œí”Œë¦¿ ì½œë°± íŒ¨í„´ì˜ í›„ë³´ëŠ” **try/catch/finally**ì„ ì‚¬ìš©í•˜ëŠ” ì½”ë“œë‹¤!   

#### ì¤‘ë³µì˜ ì œê±°ì™€ í…œí”Œë¦¿/ì½œë°± ì„¤ê³„
- BufferedReaderë¥¼ ì „ë‹¬ë°›ëŠ” ì½œë°± ì¸í„°í˜ì´ìŠ¤
```java
public interface BufferedReaderCallback{
    Integer doSomethingWithReader(BufferedReader br) throws IOException;
}
```

- BufferedReaderCallbackì„ ì‚¬ìš©í•˜ëŠ” í…œí”Œë¦¿ ë©”ì†Œë“œ
```java
public integer fileReadTemplate(String filepath, BufferedReaderCallback callback) throws IOException {
    BufferedReader br = null;
    try {
        br = new BufferedReader(new FileReader(filepath));
        int ret = callback.doSomethingWithReader(br); //ì½œë°±ì˜¤ë¸Œì íŠ¸ í˜¸ì¶œ
        return ret;
    }
    catch(IOException e) {
        System.out.println(e.getMessage());
        throw e;
    }
    finally {
        if (br != null) {
            try {br.close();}
            catch(IOException e) {
                System.out.println(e.getMessage());
            }
        }
    }
}
```

- í…œí”Œë¦¿/ì½œë°±ì„ ì ìš©í•œ calcSum() ë©”ì†Œë“œ
```java
public Integer calcSum(String filepath) throws IOException {
    BufferedReaderCallback sumCallback = new BufferedReaderCallback() {
        public Integer doSomethingWithReader(BufferedReader br) throws IOException {
            Integer sum = 0;
            String line = null;
            while ((line = br.readLine()) != null){
                sum += Integer.valueOf(line);
            }
            return sum;
        }
    };
    return fileReadTempalte(filepath, sumCallback);
}
```

#### í…œí”Œë¦¿/ì½œë°±ì˜ ì¬ì„¤ê³„
ë‹¤ì‹œ ê³µí†µëœ ë¶€ë¶„ì„ ë” ë½‘ì•„ë³´ì.

- ë¼ì¸ë³„ ì‘ì—…ì„ ì •ì˜í•œ ì½œë°± ì¸í„°í˜ì´ìŠ¤
```java
public interface LineCallback{
    Integer doSomethingWithLine(String line, Integer value);
}
```

- LineCallback ì‚¬ìš©í•˜ëŠ” í…œí”Œë¦¿ ë©”ì†Œë“œ
```java
public integer lineReadTemplate(String filepath, LineCallback callback, int initVal) throws IOException {
    BufferedReader br = null;
    try {
        br = new BufferedReader(new FileReader(filepath));
        Integer res = initVal;
        String line = null;
        while ((line = br.readLine()) != null)
        res = callback.doSomethingWithLine //ê°ë¼ì¸ì˜ ë‚´ìš©ì„ ê°€ì§€ê³  ê³„ì‚°í•˜ëŠ” ì‘ì—…ë§Œ ì½œë°±ì—ê²Œ ë§¡ê¸´ë‹¤.
        return res;
    }
    catch(IOException e) {
        System.out.println(e.getMessage());
        throw e;
    }
    finally {
        if (br != null) {
            try {br.close();}
            catch(IOException e) {
                System.out.println(e.getMessage());
            }
        }
    }
}
```

- calcSum(), calcMultiply() ë©”ì†Œë“œ
```java
public Integer calcSum(String filepath) throws IOException {
    LineCallback sumCallback = new LineCallback() {
        public Integer doSomethingWithLine(String line, Integer value) throws IOException {
           return value + Integer.valueOf(line);
        }
    };
    return lineReadTemplate(filepath, sumCallback, 0);
}


public Integer calcMultiply(String filepath) throws IOException {
    LineCallback multiplyCallback = new LineCallback() {
        public Integer doSomethingWithLine(String line, Integer value) throws IOException {
           return value * Integer.valueOf(line);
        }
    };
    return lineReadTemplate(filepath, multiplyCallback, 1);
}
```


#### ì œë„¤ë¦­ìŠ¤ë¥¼ ì´ìš©í•œ ì½œë°± ì¸í„°í˜ì´ìŠ¤
íŒŒì¼ì„ ë¼ì¸ ë‹¨ìœ„ë¡œ ì²˜ë¦¬í•´ì„œ ë§Œë“ ëŠ” ê²°ê³¼ì˜ íƒ€ì…ì„ ë‹¤ì–‘í•˜ê²Œ ê°€ì ¸ê°€ê³  ì‹¶ë‹¤ë©´, 
ìë°” ì–¸ì–´ì— íƒ€ì… íŒŒë¼ë¯¸í„°ë¼ëŠ” ê°œë…ì„ ë„ì…í•œ ì œë„¤ë¦­ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤!   
ì œë„¤ë¦­ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ ë‹¤ì–‘í•œ ì˜¤ë¸Œì íŠ¸ íƒ€ì…ì„ ì§€ì›í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë‚˜ ë©”ì†Œë“œë¥¼ ì •ì˜í•  ìˆ˜ ìˆë‹¤.   

<br>

## 3.6 ìŠ¤í”„ë§ì˜ JDBCTEMPLATE
ìŠ¤í”„ë§ì´ ì œê³µí•˜ëŠ” jdbc ì½”ë“œìš© ê¸°ë³¸ í…œí”Œë¦¿ì€ JdbcTemplateì´ë‹¤.

### ğŸƒ update()
```java
this.jdbcTemplate.update("insert into users(id, name, passowrd) values(?,?,?)",
user.getId(), user.getName(), user.getPassword());
```
### ğŸƒ queryForInt()
```java
public int getCount() {
    return this.jdbcTemplate.queryForInt("select count(*) from users");
}
```
Integer íƒ€ì…ì˜ ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” sql ë¬¸ì¥ë§Œ ì „ë‹¬í•´ì£¼ë©´ ëœë‹¤.

### ğŸƒ queryForObject()
```java
public User get(String id) {
    return this.jdbcTemplate.queryForObject("select * from users where id = ?",
    new Object[] {id},
    new RowMapper<User>(){
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    });
}
```
ì²«ë²ˆì§¸ íŒŒë¼ë¯¸í„°ëŠ” PreparedStatementë¥¼ ë§Œë“¤ê¸° ìœ„í•œ sqlì´ê³ ,   
ë‘ë²ˆì§¸ëŠ” ì—¬ê¸°ì— ë°”ì¸ë”©í•  ê°’ë“¤ì´ë‹¤.   
ë°°ì—´ ì´ˆê¸°í™” ë¸”ë¡ì„ ì‚¬ìš©í•´ì„œ sqlì˜ ?ì— ë°”ì¸ë”©í•  idê°’ì„ ì „ë‹¬í•œë‹¤.

#### query() í…œí”Œë¦¿ì„ ì´ìš©í•˜ëŠ” getAll() êµ¬í˜„
queryForObject()ëŠ” ì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ ë¡œìš° í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•˜ê³ ,   
query()ëŠ” ì—¬ëŸ¬ê°œì˜ ë¡œìš°ê°€ ê²°ê³¼ë¡œ ë‚˜ì˜¤ëŠ” ì¼ë°˜ì ì¸ ê²½ìš°ì— ì“¸ ìˆ˜ ìˆë‹¤.   
query()ì˜ ë¦¬í„´íƒ€ì…ì€ List<T>ë‹¤.

- getAll() ë©”ì†Œë“œ
```java
public List<User> getAll() {
    return this.jdbcTemplate.query(
        "select * from users order by id",
        new RowMapper<User>(){
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    });
}
```
query() í…œí”Œë¦¿ì€ sqlì„ ì‹¤í–‰í•´ì„œ ì–»ì€ resultsetì˜ ëª¨ë“  ë¡œìš°ë¥¼ ì—´ëŒí•˜ë©´ì„œ
ë¡œìš°ë§ˆë‹¤ RowMapperì½œë°±ì„ í˜¸ì¶œí•œë‹¤. RowMapperëŠ” í˜„ì¬ë¡œìš°ì˜ ë‚´ìš©ì„ user íƒ€ì… ì˜¤ë¸Œì íŠ¸ì— ë§¤í•‘í•´ì„œ ëŒë ¤ì¤€ë‹¤.   

### ğŸƒ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì½œë°±ì˜ ë¶„ë¦¬
ìµœì¢…ì ìœ¼ë¡œ ì™„ì„±ëœ UserDao í´ë˜ìŠ¤ë‹¤.   
í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ê³¼ dië¥¼ ì´ìš©í•´ ì˜ˆì™¸ì²˜ë¦¬ì™€ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬, ìœ ì—°í•œ datasource í™œìš©
ë°©ë²•ê¹Œì§€ ì œê³µí•˜ë©´ì„œ ê¹”ë”í•˜ê³  ê°„ê²°í•œ ì½”ë“œë¡œ ì •ë¦¬ê°€ ê°€ëŠ¥í•˜ê²Œ ë˜ì—ˆë‹¤!!!    

- jdbctemplateë¥¼ ì ìš©í•œ UserDao í´ë˜ìŠ¤
```java
public class UserDao {
    public void setDataSource(DataSource dataSource){
        this.jdbcTemplate = new JdbcTemplate(dataSource);
    }

    private JdbcTemplate jdbcTemplate;

    private RowMapper<User> userMapper =
    new RowMapper<User>(){
        public User mapRow(ResultSet rs, int rowNum) throws SQLException {
            User user = new User();
            user.setId(rs.getString("id"));
            user.setName(rs.getString("name"));
            user.setPassword(rs.getString("password"));
            return user;
        }
    };

    public void add(final User user){
        this.jdbcTemplate.update("insert into users(id, name, passowrd) values(?,?,?)",
        user.getId(), user.getName(), user.getPassword());
    }

    public User get(String id){
        return this.jdbcTemplate.queryForObject("select * from users where id = ?",
        new Object[] {id}, this.userMapper);
    }

    public void deleteAll(){
        this.jdbcTemplate.update("delete from users");
    }

    public int getCount() {
    return this.jdbcTemplate.queryForInt("select count(*) from users");
    }

    public List<User> getAll(){
        return this.jdbcTemplate.query("select * from users order by id",
        this.userMapper);
    }
}
```

ì´ë ‡ê²Œ ì½”ë“œë¥¼ ê°œì„  ì‹œì¼œë³´ì•˜ì§€ë§Œ, ì‹¤ì œë¡œ ìŠ¤í”„ë§ì—ì„œ jdbcë¥¼ì´ìš©í•œ daoë¥¼ë§Œë“¤ ë•Œ jdbcTemplateëŠ” ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ”ë‹¤.   
ìŠ¤í”„ë§ ì´ˆì°½ê¸°ì— ë§ì´ ì‚¬ìš©ëì§€ë§Œ ì§€ê¸ˆì€ ì£¼ë¡œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©°, ì¤‘ìš”í•œ ê²ƒì€ í…œí”Œë¦¿/ì½œë°± íŒ¨í„´ì˜ ì›ë¦¬ì™€ ì´ë¥¼ ì‘ìš©í•˜ëŠ” ë°©ë²•ì´ë‹¤.

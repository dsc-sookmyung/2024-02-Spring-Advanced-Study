# 8장 스프링이란 무엇인가
## 8.1 스프링의 정의
**자바 엔터프라이즈 개발을 편하게 해주는 오픈소스 경량급 애플리케이션 프레임워크**
- 애플리케이션 프레임워크
	- 프레임워크는 애플리케이션의 특정 계층에서 주로 동작하는 한 가지 기술 분야에 집중됨
	- 애플리케이션 프레임워크는 특정 계층이나, 기술, 업문 분야에 국한되지 않고 애플리케이션의 전 영역을 포과하는 범용적인 프레임워크로, 애플리케이션 개발의 전 과정을 빠르고 편리하며 효율적으로 진행하는데 일차적인 목표를 둔다.
	- 자바 엔터프라이즈 개발 전략을 다룬 책의 예제로 등장한 것 (각각의 프레임워크였음) -> 이걸 합쳐서 애플리케이션 프레임워크로 만듦

- 경량급
	- 불필요하게 무겁지 않음
	- ELB와 대비 </br></br>

	|ELB|스프링|
	|--|--|
	| 무거운 자바 서버 필요 (WAS) | 가벼운 서버 환경 (톰캣, 제티) |
	- 스프링이 다른 프레임워크에 비해 코드도 단순하고 작고, 개발 과정도 단순하다 (프레임워크와 서버환경에 의존적인 부분을 제거해주기 때문)

- 자바 엔터프라이즈 개발을 편하게
초기에 스프링의 기본 설정과 적용 기술만 잘 선택하고 준비해두면, 이후로 애플리케이션 개발 중에는 스프링과 관련된 코드나 API에 대해 개발자가 거의 신경 쓸 일이 없다.

- 오픈소스
이슈트래커 등으로 개발자들의 자발적인 오류 보고를 한다는 것을 포함한 다양한 장점을 갖기 위해 오픈소스를 선택하였다. 다만, 기존 오픈소스 개발 모델은 개발자들이 여가시간을 이용해 개발하다보니 기속적이고 안정적인 개발이 계속될지가 불확실하다는 한계가 있었는데, 스프링은 개발을 책임지고 진행할 수 있는 전문 기업을 만들어 한계를 극복했다.

## 8.2 스프링의 목적

### 8.2.1 엔터프라이즈 개발의 복잡함
2000년대 초반엔 80%의 이상의 자바 엔터프라이즈 프로젝트가 실패했었음 -> 복잡함때문
**🌿복잡함의 근본적인 이유**
 - 첫 번째는 기술적인 제약조건과 요구사항이 늘어가기 때문이다
엔터프라이즈 시스템이 기업 업무를 처리하는 데 핵심적인 역할로 등장하고 중요해지면서 점점 더 기술적인 요구는 심화되고 그에 따른 복잡도는 증가한다.

 - 두 번째는 엔터프라이즈 애플리케이션이 구현해야 할 핵심기능인 비즈니스 로직의 복잡함이 증가하기 때문이다
 엔터프라이즈 시스템에 대한 업무 의존도가 높아졌고, 경제 흐름과 사회의 변화, 업계의 추이에 따라서 수시로 업무 프로세스를 변경하고 조종하는 것을 상시화할 만큼 변화의 속도가 빨라져서 애플리케이션을 자주 수정해줘야했다
 -> 개발 난이도 증가

**🌿복잡함을 가중시키는 원인**
근본적인 비즈니스 로직과 엔터프라이즈 기술이라는 두 가지 복잡함이 한데 얽혀 있어, 개발은 물론이고 유지보수하는데 엄청난 어려움을 줌

### 8.2.2 복잡함을 해결하려는 도전

**🌿제거될 수 없는 근본적인 복잡함**
- 근본적으로 엔터프라이즈 개발에 나타나는 복잡함의 원인은 제거 대상이 아닌 효과적으로 상대할 수 있는 전략과 기법으로 해결해야 함
- 비즈니스 로직의 복잡함과 기술적인 복잡함을 효과적으로 처리하는 데 적용되는 방법이 다름 -> 분리

**🌿실패한 해결책: EJB**
EJB도 이를 일부 분리했지만, 특정 인터페이스를 구현하고 특정 클래스를 상속하고 서버에 종속적인 서비스를 통해서만 사용이 가능하게 만드는 등의 더 큰 복잡함을 추가했다. 또한 자바의 장점인 상속 구조, 다형성 적용 등도 제한하였다.

**🌿비침투적인 방식을 통한 효과적인 해결책: 스프링**
- 비침투적인 기술 : 기술의 적용 사실이 코드에 직접 반영되지 않음
- 스프링은 비침투적인 기술이라는 전략을 써서 기술적인 복잡함과 비즈니스 로직을 다루는 코드를 깔끔하게 분리할 수 있었다.
### 8.2.3 복잡함을 상대하는 스프링의 전략

**🌿기술적 복잡함을 상대하는 전략**

- 첫 번째 문제: 기술에 대한 접근 방식이 일관성이 없고, 특정 환경에 종속적이다
서비스 추상화. 기술적인 복잡함은 일단 추상화를 통해 로우레벨의 기술 구현 부분과 기술을 사용하는 인터페이스를 분리하고, 환경과 세부 기술에 독립적인 접근 인터페이스를 제공하는 것이 가장 좋은 해결책

- 두 번째 문제: 기술적인 처리를 담당하는 코드가 성격이 다른 코드에 섞여서 등장한다
AOP는 최후까지 애플리케이션 로직을 담당하는 코드에 남아있는 기술 관련 코드를 깔끔하게 분리해서 별도의 모듈로 관리하게 해주는 기술. 코드 중복 제거해줌.

**🌿비즈니스와 애플리케이션 로직의 복잡함을 상대하는 전략**
- 비즈니스 로직 코드 : 애플리케이션에서 가장 중요한 핵심. 자주 변경되거나 수정됨.
- 이전에는 DB에서 SQL로 표현했으나 비용, 유지보수, 테스트 등의 다양한 측면에서 확장이 쉬운 애플리케이션에 두는 걸로 추세가 바뀜.
- 객체지향 프로그래밍 기법과 언어가 주는 장점인 유연한 설계가 가능하고 재사용성이 높다는 점을 잘 활용하면 자주 바뀌고 조건이 까다로운 비즈니스 로직을 효과적으로 구현해낼 수 있다.
스프링은 단지 객체지향 언어의 장점을 제대로 살리지 못하게 방해했던 요소를 제거하도록 도와줄 뿐이다.

**🌿핵심 도구: 객체지향과 DI**
- 기술적인 복잡함을 효과적으로 다루게 해주는 기법은 모두 DI를 바탕으로 하고 있다. 그리고 DI는 객체지행 설계 기술이 없이는 그 존재의미가 없다.
- DI는 좋은 오브젝트 설계의 결과물이기도 하지만, 반대로 DI를 열심히 적용하다 보면 객체지향 설계의 원칙을 잘 따르고 그 장점을 살린 설계가 나올 수도 있다.
- 모든 스프링의 기술과 전략은 객체지향이라는 자바 언어가 가진 강력한 도구를 극대화해서 사용할 수 있도록 돕는 것이라고 볼 수 있다.

## 8.3 POJO 프로그래밍
분리됐지만 반드시 필요한 엔터프라이즈 서비스 기술을 POJO 방식으로 개발된 애플리케이션 핵심 로직을 담은 코드에 제공한다

### 8.3.1 스프링의 핵심: POJO
스프링 애플리케이션은 POJO를 이용해서 만든 애플리케이션 코드와, POJO가 어떻게 관계를 맺고 동작하는지를 정의해놓은 설계정보로 구분된다.
스프링의 주요 기술인 IoC/DI, AOP와 PSA는 애플ㄹ리케이션을 POJO로 개발할 수 있게 해주는 기능기술이다.

### 8.3.2 POJO란 무엇인가?
Plain Old Java Object : 자바의 단순한 오브젝트를 이용해 애플리케이션의 비즈니스 로직을 구현하는 것

### 8.3.3 POJO의 조건

- 특정 규약에 종속되지 않는다
자바 언어와 꼭 필용한 API 외에는 종속되지 않아야 함. 
특정 규약을 따라 만들게 하는 경우는 대부분 규약에서 제시하는 특정 클래스를 상속하도록 요구한다. 그럴 경우 자바의 단일 상속 제한 때문에 더 이상 해당 클래스에 객체지향적인 설계 기법을 적용하기가 어려워지고 규약이 적용된 환경에 종속적이 되기 때문에 다른 환경으로 이전이 힘들다는 문제점이 있다.

- 특정 환경에 종속되지 않는다
	- 특정 환경에 종속적인 클래스나 API를 직접 사용하면 안됨
	- 비즈니스 로직을 담고 있는 POJO 클래스는 웹이라는 환경정보나 웹 기술을 담고 있는 클래스나 인터페이스를 사용해서는 안됨 -> 웹 환경에 종속적이지 않기 위해
	- 애노테이션을 사용하더라도 환경에 종속되지만 않는다면 POJO

	이를 모두 충족하며 객체지행적인 자바 언어의 기본에 충실하게 만들어져야지 POJO

진정한 POJO란 객체지향적인 원리에 충실하면서, 환경과 기술에 종속되지 않고 필요에 따라 재활용될 수 있는 방식으로 설계된 오브젝트를 말한다. 그런 POJO 애플리케이션의 핵심 로직과 기능을 담아 설계하고 개발하는 방법을 POJO 프로그래밍이라고 할 수 있다.

### 8.3.4 POJO의 장점
- 특정한 기술과 환경에 종속되지 않는 오브젝트는 그만큼 깔끔한 코드가 될 수 있다.
- POJO로 개발된 코드는 자동화된 테스트에 매우 유리하다.
- 객체지향적인 설계를 자유롭게 적용할 수 있다.

### 8.3.5 POJO 프레임워크
- 스프링을 이용하면 POJO 프로그래밍의 장점을 그대로 살려서 엔터프라이즈 애플리케이션의 핵심 로직을 객체지향적인 POJO를 기반으로 깔끔하게 구현하고, 동시에 엔터프라이즈 환경의 각종 서비스와 기술적인 필요를 POJO 방식으로 만들어진 코드에 적용할 수 있다.
- POJO 프레임워크로서 스프링은 잔신을 직접 노출하지 않으면서 비즈니스 로직의 복잡함과 엔터프라이즈 기술의 복잡함을 분리해서 구성할 수 있게 도와준다.
- 스프링이 제공하는 기술과, 프레임워크 API 및 확장 포인트는 그것을 이용하는 코드가 자연스럽게 객체지향적인 설계원리를 따라가도록 이끌어주기도 한다.

## 8.4 스프링의 기술
스프링의 기술들(IoC/DI, AOP, PSA)은 스프링 프레임워크가 만들어진 진정한 목표인 POJO 기반의 엔터프라이즈 개발을 편리하게 해주는 도구이다.

### 8.4.1 제어의 역전(IoC) / 의존관계 주입(DI)
DI의 장점 : 개방 폐쇄 원칙(OCP) : 유연한 확장과 재사용 가능

🌿DI의 활용 방법

- 핵심기능의 변경
	- 의존 대상의 구현을 바꿈 (ex. 디자인 패턴의 전략 패턴)
	- 구현 방식을 통째로 바꿈
	- 실제 의존하는 대상이 가진 핵심기능을 DI 설정을 통해 변경

- 핵심기능의 동적인 변경
애플리케이션이 동작하는 중간에 그 의존 대상을 다이내믹하게 변경
-> 다이내믹 라우팅 프록시나 프록시 오브젝트 기법을 활용

- 부가기능의 추가
인터페이스를 두고 사용하게 하고, 실제 사용할 오브젝트는 외부에서 주입하는 DI를 적용해두면 데코레이터 패턴을 쉽게 적용할 수 있다. 그래서 핵심기능과 클라이언트 코드에는 전혀 영향을 주지 않으면서 부가적인 기능을 얼마든지 추가할 수 있다.

- 인터페이스의 변경
사용하려고 하는 오브젝트가 가진 인터페이스가 클라이언트와 호환되지 않는 경우
: 인터페이스가 다른 오브젝트를 클라이언트가 사용하는 인터페이스로 바꿔주는 기능을 이용하면 됨
-> 오브젝트 방식의어댑터 패턴의 응용
	
	PSA는 클라이언트가 일관성 있게 사용할 수 있는 인터페이스를 정의해주고 DI를 통해 어댑터 역할을 하는 오브젝트를 이용하게 해준다. 이를 통해서 다른 인터페이스를 가진 로우레벨의 기술을 변경/확장해가면서 사용할 수 있다.
	
- 프록시
필요한 시점에서 실제 사용ㅎㄹ 오브젝트를 초기화하고 리소스를 준비하게 해주는 지연된 로딩, 원격 오브젝트를 호출할 때 마치 로컬에 존재하는 오브젝트처럼 사용할 수 있게 해주는 원격 프록시를 적용할 때 프록시가 필요 -> DI 필요

- 템플릿과 콜백
반복적으로 등장하지만 항상 고정적인 작업 흐름과 그 사이에서 자주 바뀌는 부분을 분리해서 템플릿과 콜백으로 만들고 이를 DI 원리를 응용해 적용하면 지저분하게 매번 만들어야 하는 코드를 간결하게 만들 수 있음.

- 싱글톤과 오브젝트 스코프
오브젝트의 생성부터 관계설정, 이용, 소멸에 이르기까지의 모든 생명주기 과정을 DI 컨테이너가 주관하기 때문에 그 오브젝트의 스코프를 자유롭게 제어할 수 있다.
스프링에선 기본적으로 싱글톤(컨테이너가 관리하는 IoC 방법으로, 클래스에서는 싱글톤을 고려하지 않고 설계해도 됨), 필요에 따라 다양한 스코프를 갖는 오브젝트를 만들어 DI에 사용할 수 있다.

- 테스트
오브젝트에 의존하는 오브젝트를 테스트하기 위해선 목 오브젝트가 필요하다.
DI를 위해 만든 수정자 메소드를 사용하면 테스트 코드 안에서 수동으로 목 오브젝트를 주입할 수 있다.

### 8.4.2 에스펙트 지향 프로그래밍(AOP)
AOP는 객체지향 기술의 한계와 단점을 극복하도록 도와주는 보조적인 프로그램 기술이다.

🌿AOP의 적용 기법

- 첫 번째는 스프링과 같이 다이내믹 프록시를 사용하는 방법이다
기존 코드에 영향을 주지 않고 부가기능을 적용하게 해주는 데코레이터 패턴을 응용
	- 장점 : 자바의 객체지향 패턴을 활용한 방법 -> 만들기 쉽고 적용하기 간편함
	- 단점 : 부가기능을 부여할 수 있는 곳은 메소드의 호출이 일어나는 지점뿐

	스프링의 기본적인 AOP 구현 방법은 다이내믹 프록시를 이용하는 프록시 AOP 방식

- 두 번째는 자바 언어의 한계를 넘어서는 언어의 확장을 이용하는 방법이다
AsepctJ
	- 장점 : 프록시 방식의 AOP에서는 불가능한 다양한 조인포인트를 제공. 메소드 호출뿐 아니라 인스턴스 생성, 필드 액세스 등에서도 부가기능을 제공할 수 있음.
	- 별도의 방법이 필요해서 사용하기 까다롭고 번잡

🌿AOP의 적용단계

- AOP 적용 1단계: 미리 준비된 AOP 이용
스프링이 제공하는 AOP (트랜잭션, @Configuration으로 도메인 오브젝트에 DI를 자동 적용해주는 기능 등)을 먼저 이용해봄

- AOP 적용 2단계: 전담팀을 통한 정책 AOP 적용
정책적으로 적용할 만한 기능에 AOP를 이용
개발자가 직접 코드에 추가하면 수정이 필요할 때 큰 부담 
-> 전담팀이 AOP를 이용해 한 번에 적용한다면 일반 개발자의 작업에는 영향을 주지 않음

- AOP 적용 3단계: AOP의 자유로운 이용
AOP에 충분히 친숙하고 이해했다면 구현 기능에 적용

### 8.4.3 포터블 서비스 추상화(PSA)
환경과 세부 기술의 변화에 관계없이 일관된 방식으로 기술에 접근할 수 있게 해줌
- 트랜잭션 서비스 추상화 
- OXM이나 JavaMail : 스프링이 제공하는 API를 사용해서 만듦

직접 서비스 추상화 기법을 적용할 수 있음 - DI만 적극 활용하면 됨.



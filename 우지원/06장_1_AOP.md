# 6ì¥ AOP
1. [íŠ¸ëœì­ì…˜ ì½”ë“œì˜ ë¶„ë¦¬](#61-íŠ¸ëœì­ì…˜-ì½”ë“œì˜-ë¶„ë¦¬)
2. [ê³ ë¦½ëœ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸](#62-ê³ ë¦½ëœ-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸)
3. [ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì™€ íŒ©í† ë¦¬ ë¹ˆ](#63-ë‹¤ì´ë‚´ë¯¹-í”„ë¡ì‹œì™€-íŒ©í† ë¦¬-ë¹ˆ)

<br>

## 6.1 íŠ¸ëœì­ì…˜ ì½”ë“œì˜ ë¶„ë¦¬

AOPëŠ” IoC/DI, ì„œë¹„ìŠ¤ ì¶”ìƒí™”ì™€ ë”ë¶ˆì–´ ìŠ¤í”„ë§ì˜ 3ëŒ€ ê¸°ë°˜ê¸°ìˆ ì˜ í•˜ë‚˜ë‹¤.   
ìŠ¤í”„ë§ì— ì ìš©ëœ ê°€ì¥ ì¸ê¸° ìˆëŠ” AOPì˜ ì ìš© ëŒ€ìƒì€ ë°”ë¡œ ì„ ì–¸ì  íŠ¸ëœì­ì…˜ ê¸°ëŠ¥ì´ë‹¤!   
ì„œë¹„ìŠ¤ ì¶”ìƒí™”ë¥¼ í†µí•´ ë§ì€ ê·¼ë³¸ì ì¸ ë¬¸ì œë¥¼ í•´ê²°í–ˆë˜ íŠ¸ëœì­ì…˜ ê²½ê³„ì„¤ì • ê¸°ëŠ¥ì„ AOPë¥¼ ì´ìš©í•´ ë°”ê¿”ë³´ì.   

### ğŸƒ ë©”ì†Œë“œ ë¶„ë¦¬
ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì½”ë“œë¥¼ ì‚¬ì´ì— ë‘ê³  íŠ¸ëœì­ì…˜ ì‹œì‘ê³¼ ì¢…ë£Œë¥¼ ë‹´ë‹¹í•˜ëŠ” ì½”ë“œê°€ ì•ë’¤ì— ìœ„ì¹˜í•¨.   
=> ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì½”ë“œë¥¼ **ë©”ì†Œë“œ**ë¡œ ì¶”ì¶œí•´ì„œ ë…ë¦½ì‹œí‚¤ì.   

### ğŸƒ DIë¥¼ ì´ìš©í•œ í´ë˜ìŠ¤ì˜ ë¶„ë¦¬

#### DI ì ìš©ì„ ì´ìš©í•œ íŠ¸ëœì­ì…˜ ë¶„ë¦¬
UserServiceë¥¼ êµ¬í˜„í•œ ë˜ ë‹¤ë¥¸ êµ¬í˜„ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì.   
UserServiceë¥¼ êµ¬í˜„í•œ UserServiceTxëŠ” íŠ¸ëœì­ì…˜ ê²½ê³„ì„¤ì •ì´ë¼ëŠ” ì±…ì„ì„ ë§¡ê³  ìˆì„ ë¿ì´ë‹¤.   

#### UserService ì¸í„°í˜ì´ìŠ¤ ë„ì…
```java
public interface UserService {
	void add(User user);
	void upgradeLevels();
}
```

```java
public class UserServiceImpl implements UserService {
	UserDao userDao;
	MailSender mailSender;

	public void upgradeLevels() {
		List<User> users = userDao.getAll();
		for (User user: users) {
			if (canUpgradeLevel(user)) {
				upgradeLevel(user);
			}
		}
	}
	...
}
```
#### ë¶„ë¦¬ëœ íŠ¸ëœì­ì…˜ ê¸°ëŠ¥
ë¹„ì¦ˆë‹ˆìŠ¤ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ë¥¼ ë‹´ì€ UserServiceTxë¥¼ ë§Œë“¤ì–´ë³´ì.   
ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì—ê²Œ ì‘ì—…ì„ ìœ„ì„í•˜ê²Œ ë˜ë©´ ëœë‹¤.   
ê·¸ë¦¬ê³  ì—¬ê¸°ì— íŠ¸ëœì­ì…˜ì˜ ê²½ê³„ì„¤ì •ì´ë¼ëŠ” ë¶€ê°€ì ì¸ ì‘ì—…ì„ ë¶€ì—¬í•´ë³´ì!   

- íŠ¸ëœì­ì…˜ì´ ì ìš©ëœ UserServiceTx
```java
public class UserServiceTx implements UserService {
	UserService userService;
	PlatformTransactionManager transactionManager;

	public void setTransactionManager(PlatformTransactionManager transactionManager){
		this.transactionManager = transactionManager;
	}

	public void setUserService(UserService userService){
		this.userService = userService;
	}

	public void add(User user){
		this.userService.add(user);
	}

	public void upgradeLevels() {
		TransactionStatus status = this.transactionManager.getTransaction(new DefaultTransactionDefinition());
		
		try {
			userService.upgradeLevels();
			this.transactionManager.commit(status);
		} catch (RuntimeException e) {
			this.transactionManager.rollback(status);
			throw e;
		}
	}
}
```
#### íŠ¸ëœì­ì…˜ ì ìš©ì„ ìœ„í•œ DI ì„¤ì •
ê¸°ì¡´ì— userService ë¹ˆì´ ì˜ì¡´í•˜ê³  ìˆë˜ transactionManagerëŠ” UserServiceTxì˜ ë¹ˆì´,   
userDaoì™€ mailSenderëŠ” UserServiceImpl ë¹ˆì´ ê°ê° ì˜ì¡´í•˜ë„ë¡ í”„ë¡œí¼í‹° ì •ë³´ë¥¼ ë¶„ë¦¬í•œë‹¤.   

#### íŠ¸ëœì­ì…˜ ê²½ê³„ì„¤ì • ì½”ë“œ ë¶„ë¦¬ì˜ ì¥ì 
1. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ê³  ìˆëŠ” UserServiceImplì˜ ì½”ë“œë¥¼ ì‘ì„±í•  ë•ŒëŠ” íŠ¸ëœì­ì…˜ê³¼ ê°™ì€ 
ê¸°ìˆ ì ì¸ ë‚´ìš©ì—ëŠ” ì‹ ê²½ì“°ì§€ ì•Šì•„ë„ ë¨.   
2. ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì†ì‰½ê²Œ ë§Œë“¤ì–´ ë‚¼ ìˆ˜ ìˆìŒ.

## 6.2 ê³ ë¦½ëœ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
í…ŒìŠ¤íŠ¸ëŠ” ì‘ì€ ë‹¨ìœ„ë¡œ í•˜ë©´ ì¢‹ë‹¤.   
í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ë‹¤ë¥¸ ì˜¤ë¸Œì íŠ¸ì™€ í™˜ê²½ì— ì˜ì¡´í•˜ê³  ìˆë‹¤ë©´ ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸ê°€ ì£¼ëŠ” ì¥ì ì„ ì–»ê¸° í˜ë“¤ë‹¤.    

### ğŸƒ ë³µì¡í•œ ì˜ì¡´ê´€ê³„ ì†ì˜ í…ŒìŠ¤íŠ¸
UserServiceë¼ëŠ” í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ í…ŒìŠ¤íŠ¸ ë‹¨ìœ„ì¸ ê²ƒì²˜ëŸ¼ ë³´ì¸ë‹¤.   
í•˜ì§€ë§Œ, ê·¸ ë’¤ì˜ ì˜ì¡´ê´€ê³„ë¥¼ ë”°ë¼ ë“±ì¥í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ì™€ ì„œë¹„ìŠ¤, í™˜ê²½ ë“±ì´ ëª¨ë‘ í•©ì³ì„œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì´ ëœë‹¤.   
=> ì´ ê²½ìš° í…ŒìŠ¤íŠ¸ ì¤€ë¹„ê°€ í˜ë“¤ê³ , í™˜ê²½ì´ ì¡°ê¸ˆì´ë¼ë„ ë‹¬ë¼ì§€ë©´ ë™ì¼í•œ í…ŒìŠ¤íŠ¸ ê²°ê³¼ë¥¼ ë‚´ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

### ğŸƒ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ ê³ ë¦½ì‹œí‚¤ê¸°

#### í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ UserServiceImpl ê³ ë¦½
UserServiceImpl ê³¼ì˜ ì‚¬ì´ì—ì„œ ì£¼ê³ ë°›ì€ ì •ë³´ë¥¼ ì €ì¥í•´ë’€ë‹¤ê°€,   
í…ŒìŠ¤íŠ¸ì˜ ê²€ì¦ì— ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ëª©ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“¤ì.   

#### ê³ ë¦½ëœ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í™œìš©
1. í…ŒìŠ¤íŠ¸ ì‹¤í–‰ì¤‘ì— UserDaoë¥¼ í†µí•´ ê°€ì ¸ì˜¬ í…ŒìŠ¤íŠ¸ìš© ì •ë³´ë¥¼ dbì— ë„£ëŠ”ë‹¤.
2. ë©”ì¼ ë°œì†¡ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•´ MailSender ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ di í•´ì¤€ë‹¤.
3. ì‹¤ì œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒì¸ userService ë©”ì†Œë“œë¥¼ ì‹¤í–‰í•œë‹¤.
4. ê²°ê³¼ê°€ dbì— ë°˜ì˜ëëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•´ì„œ UserDao ë¥¼ ì´ìš©í•´ dbì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ ê²°ê³¼ë¥¼ í™•ì¸í•˜ë‹¤.
5. ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ í†µí•´ UserServiceì— ì˜í•œ ë©”ì¼ ë°œì†¡ì´ ìˆì—ˆëŠ”ì§€ë¥¼ í™•ì¸í•˜ë©´ ëœë‹¤.   

- UserDao ì˜¤ë¸Œì íŠ¸
```java
static class MockUserDao implements UserDao{
    private List<User> users;
    private List<User> updated = new ArrayList();

    private MockUserDao(List<User> users) {
	    this.users = users;
    }

    public List<User> getUpdated() {
	    return this.updated;
    }

	//ìŠ¤í… ê¸°ëŠ¥ ì œê³µ
    public List<User> getAll() {
	    return this.users;
    }

	//ëª© ì˜¤ë¸Œì íŠ¸ ê¸°ëŠ¥ ì œê³µ
    pubilc void update(User user) {
	    updated.add(user);
    }

    // í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ë©”ì†Œë“œ
	...
}
```
=> DBì— ì§ì ‘ ê°€ì§€ ì•Šì•„ë„ ë¯¸ë¦¬ ì¤€ë¹„ëœ í…ŒìŠ¤íŠ¸ìš© ë¦¬ìŠ¤íŠ¸ë¥¼ ë©”ëª¨ë¦¬ì— ê°–ê³  ìˆë‹¤ê°€ ëŒë ¤ì£¼ëŠ” ì—­í• ì„ MockUserDaoê°€ ìˆ˜í–‰í•´ì¤€ë‹¤.   


#### í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì„±ëŠ¥ì˜ í–¥ìƒ
ê³ ë¦½ëœ í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë©´ í…ŒìŠ¤íŠ¸ê°€ ë‹¤ë¥¸ ì˜ì¡´ ëŒ€ìƒì— ì˜í–¥ì„ ë°›ì„ ê²½ìš°ë¥¼ ëŒ€ë¹„í•´ ë³µì¡í•˜ê²Œ ì¤€ë¹„í•  í•„ìš”ê°€ ì—†ì„ ë¿ë§Œ ì•„ë‹ˆë¼, 
í…ŒìŠ¤íŠ¸ ìˆ˜í–‰ ì„±ëŠ¥ë„ í¬ê²Œ í–¥ìƒë¨.   

### ğŸƒ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì™€ í†µí•© í…ŒìŠ¤íŠ¸
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ë‹¨ìœ„ëŠ” ì •í•˜ê¸° ë‚˜ë¦„ì´ë‹¤!   

ì¤‘ìš”í•œ ê²ƒì€ **í•˜ë‚˜ì˜ ë‹¨ìœ„ì— ì´ˆì ì„ ë§ì¶˜ í…ŒìŠ¤íŠ¸**ë¼ëŠ” ì ì´ë‹¤.   
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ : í…ŒìŠ¤íŠ¸ ëŒ€ìƒ í´ë˜ìŠ¤ë¥¼ ëª© ì˜¤ë¸Œì íŠ¸ ë“±ì˜ í…ŒìŠ¤íŠ¸ ëŒ€ì—­ì„ ì´ìš©í•´ ì˜ì¡´ ì˜¤ë¸Œì íŠ¸ë‚˜ ì™¸ë¶€ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šë„ë¡ ê³ ë¦½ì‹œì¼œì„œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒ   
í†µí•© í…ŒìŠ¤íŠ¸ : ë‘ ê°œ ì´ìƒì˜ ë‹¨ìœ„ê°€ ê²°í•©í•´ì„œ ë™ì‘í•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ê°€ ìˆ˜í–‰ë˜ëŠ” ê²ƒ. ìŠ¤í”„ë§ì˜ í…ŒìŠ¤íŠ¸ ì»¨í…ìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ë¥¼ ì´ìš©í•´ì„œ ì»¨í…ìŠ¤íŠ¸ì—ì„œ ìƒì„±ë˜ê³  DIëœ ì˜¤ë¸Œì íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒë„ í†µí•© í…ŒìŠ¤íŠ¸.   

### ğŸƒ ëª© í”„ë ˆì„ì›Œí¬
ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ìŠ¤í…ì´ë‚˜ ëª© ì˜¤ë¸Œì íŠ¸ì˜ ì‚¬ìš©ì´ í•„ìˆ˜ì ì´ë‹¤.   

#### Mockito í”„ë ˆì„ì›Œí¬ 
Mockito ì™€ ê°™ì€ ëª© í”„ë ˆì„ì›Œí¬ì˜ íŠ¹ì§•ì€ ëª©í´ë˜ìŠ¤ë¥¼ ì¼ì¼ì´ ì¤€ë¹„í•´ë‘˜ í•„ìš”ê°€ ì—†ë‹¤!   

- UserDao ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í…ŒìŠ¤íŠ¸ìš© ëª© ì˜¤ë¸Œì íŠ¸
```java
UserDao mockUserDao = mock(UserDao.class);
```

- getAll() ë©”ì†Œë“œê°€ ë¶ˆë ¤ì˜¬ ë•Œ ì‚¬ìš©ì ëª©ë¡ì„ ë¦¬í„´í•˜ë„ë¡ ìŠ¤í… ê¸°ëŠ¥ ì¶”ê°€
```java
when(mockUserDao.getAll()).thenReturn(this.users);
```

- mockUserDaoì˜ update() ë©”ì†Œë“œê°€ ë‘ ë²ˆ í˜¸ì¶œëëŠ”ì§€ ê²€ì¦í•˜ëŠ” ë°©ë²•
```java
verify(mockUserDao, times(2)).update(any(User.class));
```

Mockito ëª© ì˜¤ë¸Œì íŠ¸ëŠ” ë‹¤ìŒì˜ 4ë‹¨ê³„ë¥¼ ê±°ì³ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
1. ì¸í„°í˜ì´ìŠ¤ë¥¼ ì´ìš©í•´ ëª© ì˜¤ë¸Œì íŠ¸ë¥¼ ë§Œë“ ë‹¤.
2. ëª© ì˜¤ë¸Œì íŠ¸ê°€ ë¦¬í„´í•  ê°’ì´ ìˆìœ¼ë©´ ì´ë¥¼ ì§€ì •í•´ì¤€ë‹¤. ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ë©´ ì˜ˆì™¸ë¥¼ ê°•ì œë¡œ ë˜ì§€ê²Œ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.
3. í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ì— DIí•´ì„œ ëª© ì˜¤ë¸Œì íŠ¸ê°€ í…ŒìŠ¤íŠ¸ ì¤‘ì— ì‚¬ìš©ë˜ë„ë¡ ë§Œë“ ë‹¤.
4. í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•œ í›„ì— ëª© ì˜¤ë¸Œì íŠ¸ì˜ íŠ¹ì • ë©”ì†Œë“œê°€ í˜¸ì¶œëëŠ”ì§€, ì–´ë–¤ ê°’ì„ ê°€ì§€ê³  ëª‡ ë²ˆ í˜¸ì¶œëëŠ”ì§€ë¥¼ ê²€ì¦í•œë‹¤.   


- Mockitoë¥¼ ì ìš©í•œ í…ŒìŠ¤íŠ¸ ì½”ë“œ
```java
@Test
public void mockUpgradeLevels() throws Exception {
	UserServiceImpl userServiceImpl = new UserServiceImpl();
	
	// ë‹¤ì´ë‚´ë¯¹í•œ ëª© ì˜¤ë¸Œì íŠ¸ ìƒì„± & ë©”ì†Œë“œì˜ ë¦¬í„´ ê°’ ì„¤ì • &  DI
	UserDao mockUserDao = mock(UserDao.class); 
	when(mockUserDao.getAll()).thenReturn(this.users); 
	userServiceImpl.setUserDao(mockUserDao);
	
	//MialSenderë„ ê°„ë‹¨íˆ ëª©ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ê³ , DIí•´ì¤€ë‹¤~!
	MailSender mockMailSender = mock(MailSender.class);
	userServiceImpl.setMailSender(mockMailSender);


	userServiceImpl.upgradeLevels();
	
	//ëª©ì˜¤ë¸Œì íŠ¸ê°€ ì œê³µí•˜ëŠ” ê²€ì¦ ê¸°ëŠ¥ì„ í†µí•´ì„œ ì–´ë–¤ ë©”ì†Œë“œê°€ ëª‡ ë²ˆ í˜¸ì¶œëëŠ”ì§€, íŒŒë¼ë¯¸í„°ëŠ” ë¬´ì—‡ì¸ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
	verify(mockUserDao, times(2)).update(any(User.class));
	verify(mockUserDao, times(2)).update(any(User.class));
	verify(mockUserDao).update(users.get(1));
	assertThat(users.get(1).getLevel(), is(Level.SILVER));
	verify(mockUserDao).update(users.get(3));
	assertThat(users.get(3).getLevel(), is(Level.GOLD));
	
	ArgumentCaptor<SimpleMailMessage> mailMessageArg = ArgumentCaptor.forClass(SimpleMailMessage.class);
	verify(mockMailSender, times(2)).send(mailMessageArg.capture()); //íŒŒë¼ë¯¸í„°ë¥¼ ì •ë°€í•˜ê²Œ ê²€ì‚¬í•˜ê¸° ìœ„í•´ ìº¡ì³í•  ìˆ˜ë„ ìˆë‹¤.
	List<SimpleMailMessage> mailMessages = mailMessageArg.getAllValues();
	assertThat(mailMessages.get(0).getTo()[0], is(users.get(1).getEmail()));
	assertThat(mailMessages.get(1).getTo()[0], is(users.get(3).getEmail()));
}
```

## 6.3 ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì™€ íŒ©í† ë¦¬ ë¹ˆ

### ğŸƒ í”„ë¡ì‹œì™€ í”„ë¡ì‹œ íŒ¨í„´, ë°ì½”ë ˆì´í„° íŒ¨í„´
> **í”„ë¡ì‹œ** <br>
 ìì‹ ì´ í´ë¼ì´ì–¸íŠ¸ê°€ ì‚¬ìš©í•˜ë ¤ê³  í•˜ëŠ” ì‹¤ì œ ëŒ€ìƒì¸ ê²ƒì²˜ëŸ¼ ìœ„ì¥í•´ì„œ í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ì„ ë°›ì•„ì£¼ëŠ” ê²ƒì„ 
 ëŒ€ë¦¬ì¸ê³¼ ê°™ì€ ì—­í• ì„ í•œë‹¤ê³  í•´ì„œ í”„ë¡ì‹œë¼ê³  ë¶€ë¥¸ë‹¤. 

> **íƒ€í‚· ë˜ëŠ” ì‹¤ì²´** <br>
 í”„ë¡ì‹œë¥¼ í†µí•´ ìµœì¢…ì ìœ¼ë¡œ ìš”ì²­ì„ìœ„ì„ë°›ì•„ ì²˜ë¦¬í•˜ëŠ” ì‹¤ì œ ì˜¤ë¸Œì íŠ¸   


#### í´ë¼ì´ì–¸íŠ¸ -> í”„ë¡ì‹œ -> íƒ€ê¹ƒ (ì‚¬ìš©í•˜ëŠ” êµ¬ì¡°)
í”„ë¡ì‹œì˜ íŠ¹ì§•ì€ íƒ€ê¹ƒê³¼ ê°™ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í–ˆë‹¤ëŠ” ê²ƒê³¼ í”„ë¡ì‹œê°€ íƒ€ê¹ƒì„ ì œì–´í•  ìˆ˜ ìˆëŠ” ìœ„ì¹˜ì— ìˆë‹¤ëŠ” ê²ƒ   
í”„ë¡ì‹œë¥¼ ì‚¬ìš©ëª©ì ì— ë”°ë¼ 2ê°€ì§€ë¡œ êµ¬ë¶„ê°€ëŠ¥   
1. í´ë¼ì´ì–¸íŠ¸ê°€ íƒ€ê¹ƒì— ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì„ ì œì–´í•˜ê¸° ìœ„í•´ì„œ
2. íƒ€ê¹ƒì— ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ë¶€ì—¬í•´ì£¼ê¸° ìœ„í•´ì„œ
=> ë‘ê°€ì§€ ëª¨ë‘ ëŒ€ë¦¬ ì˜¤ë¸Œì íŠ¸ë¼ëŠ” ê°œë…ì˜ í”„ë¡ì‹œë¥¼ ë‘ê³  ì‚¬ìš©í•œë‹¤ëŠ” ì ì€ ë™ì¼,   
but, ëª©ì ì— ë”°ë¼ì„œ ë””ìì¸ íŒ¨í„´ì—ì„œëŠ” ë‹¤ë¥¸ íŒ¨í„´ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤.   

#### ë°ì½”ë ˆì´í„° íŒ¨í„´
íƒ€ê¹ƒì— ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ëŸ°íƒ€ì„ ì‹œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë¶€ì—¬í•´ì£¼ê¸° ìœ„í•´ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´   

ğŸ’¥ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ê¸°ëŠ¥ì„ ë¶€ê°€í•œë‹¤?   
ì»´íŒŒì¼ ì‹œì , ì¦‰ ì½”ë“œìƒì—ì„œëŠ” ì–´ë–¤ ë°©ë²•ê³¼ ìˆœì„œë¡œ íƒ€ê¹ƒì´ ì—°ê²°ë˜ì–´ ì‚¬ìš©ë˜ëŠ”ì§€ ì •í•´ì ¸ ìˆì§€ ì•Šë‹¤.   

#### ë°ì½”ë ˆì´í„° íŒ¨í„´ ì‚¬ìš© ì˜ˆì‹œ
1ï¸. ìë°” IO íŒ¨í‚¤ì§€ì˜ InputStreamê³¼ OutputStream êµ¬í˜„ í´ë˜ìŠ¤
```java
InputStream is = new BufferedInputStream(new FileInputStream("a.txt"));
```

2. UserService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ íƒ€ê¹ƒì¸ UserServiceImplì— íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ ì œê³µí•´ì£¼ëŠ” UserServiceTxë¥¼ ì¶”ê°€í•œ ê²ƒ
=> ìˆ˜ì •ì ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ë°ì½”ë ˆì´í„°ì¸ UserServiceTxì— ìœ„ì„í•  íƒ€ê¹ƒì¸ UserServiceImplì„ ì£¼ì…í•´ì¤€ë‹¤.   


ë°ì½”ë ˆì´í„° íŒ¨í„´ì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ìœ„ì„í•˜ëŠ” ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì–´ëŠ ë°ì½”ë ˆì´í„°ì—ì„œ íƒ€ê¹ƒìœ¼ë¡œ ì—°ê²°ë ì§€ ì½”ë“œë ˆë²¨ì—ì„  ë¯¸ë¦¬ ì•Œ ìˆ˜ ì—†ë‹¤.   
ë°ì½”ë ˆì´í„° íŒ¨í„´ì€ íƒ€ê¹ƒì˜ ì½”ë“œë¥¼ ì†ëŒ€ì§€ ã…‡ë‚³ê³ , í´ë¼ì´ì–¸íŠ¸ê°€ í˜¸ì¶œí•˜ëŠ” ë°©ë²•ë„ ë³€ê²½í•˜ì§€ ì•Šì€ ì±„ë¡œ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì¶”ê°€í•  ë•Œ ìœ ìš©í•œ ë°©ë²•ì´ë‹¤.   
 
#### í”„ë¡ì‹œ íŒ¨í„´
ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” **í”„ë¡ì‹œ**ë¼ëŠ” ìš©ì–´ì™€ ë””ìì¸ íŒ¨í„´ì—ì„œ ë§í•˜ëŠ” **í”„ë¡ì‹œíŒ¨í„´**ì€ êµ¬ë¶„í•´ì•¼í•¨.   
ì „ì : í´ë¼ì´ì–¸íŠ¸ì™€ ì‚¬ìš© ëŒ€ìƒ ì‚¬ì´ì— ëŒ€ë¦¬ ì—­í• ì„ ë§¡ì€ ì˜¤ë¸Œì íŠ¸ë¥¼ ë‘ëŠ” ë°©ë²•ì„ ì´ì¹­   
í›„ì : í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°©ë²• ì¤‘ì—ì„œ íƒ€ê¹ƒì— ëŒ€í•œ ì ‘ê·¼ ë°©ë²•ì„ ì œì–´í•˜ë ¤ëŠ” ëª©ì ì„ ê°€ì§„ ê²½ìš°   

> **í”„ë¡ì‹œ íŒ¨í„´ì˜ í”„ë¡ì‹œ** <br>
 íƒ€ê¹ƒì˜ ê¸°ëŠ¥ì„ í™•ì¥í•˜ê±°ë‚˜ ì¶”ê°€í•˜ì§€ ì•ŠëŠ”ë‹¤. ëŒ€ì‹  í´ë¼ì´ì–¸íŠ¸ê°€ íƒ€ê¹ƒì— ì ‘ê·¼í•˜ëŠ” ë°©ì‹ì„ ë³€ê²½í•´ì¤€ë‹¤.

#### í”„ë¡ì‹œ íŒ¨í„´ì„ ì ìš©í•˜ëŠ” ê²½ìš°?
- íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ê°€ ë¯¸ë¦¬ í•„ìš©í•  ë•Œ.
- í´ë¼ì´ì–¸íŠ¸ì—ê²Œ íƒ€ê¹ƒì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ë¥¼ ë„˜ê²¨ì•¼í•˜ëŠ”ë°, ì‹¤ì œ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ëŠ” ë§Œë“œëŠ” ëŒ€ì‹  í”„ë¡ì‹œë¥¼ ë„˜ê²¨ì¤Œ.   

- ì›ê²© ì˜¤ë¸Œì íŠ¸ë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš°ì—ë„ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ë©´ í¸í•¨.
 - RMIë‚˜, EJB , ê°ì¢… ë¦¬ëª¨íŒ… ê¸°ìˆ ì„ ì´ìš©í•´ ë‹¤ë¥¸ ì„œë²„ì— ì¡´ì¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´ ì›ê²© ì˜¤ë¸Œì íŠ¸ì— ëŒ€í•œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë‘ê³  
 í´ë¼ì´ì–¸íŠ¸ëŠ” ë§ˆì¹˜ ë¡œì»¬ì— ì¡´ì¬í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ì“°ëŠ” ê²ƒì²˜ëŸ¼ í”„ë¡ì‹œë¥¼ ì‚¬ìš©í•˜ê²Œ í•  ìˆ˜ ìˆë‹¤.   


- íŠ¹ë³„í•œ ìƒí™©ì—ì„œ íƒ€ê¹ƒì— ëŒ€í•œ ì ‘ê·¼ê¶Œí•œì„ ì œì–´í•˜ê¸° ìœ„í•´ í”„ë¡ì‹œ íŒ¨í„´ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŒ
 - ex. Collectionsì˜ unmodifiableCollection()ì„ í†µí•´ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸ê°€ ì „í˜•ì ì¸ ì ‘ê·¼ê¶Œí•œ ì œì–´ìš© í”„ë¡ì‹œ   

#### í”„ë¡ì‹œ íŒ¨í„´ ì •ë¦¬
íƒ€ê¹ƒì˜ ê¸°ëŠ¥ìì²´ì—ëŠ” ê´€ì—¬í•˜ì§€ ì•Šìœ¼ë©´ì„œ ì ‘ê·¼í•˜ëŠ” ë°©ë²•ì„ ì œì–´í•´ì£¼ëŠ” í”„ë¡ì‹œë¥¼ ì´ìš©í•˜ëŠ” ê²ƒ   
êµ¬ì¡°ì ìœ¼ë¡œ ë³´ìë©´ í”„ë¡ì‹œì™€ ë°ì½”ë ˆì´í„°ëŠ” ìœ ì‚¬í•˜ë‹¤.   

í•˜ì§€ë§Œ, ì°¨ì´ì !!!   
- í”„ë¡ì‹œ : ì½”ë“œì—ì„œ ìì‹ ì´ ë§Œë“¤ê±°ë‚˜ ì ‘ê·¼í•  íƒ€ê¹ƒ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ì•Œê³  ìˆëŠ” ê²½ìš°ê°€ ë§ë‹¤. 
ìƒì„±ì„ ì§€ì—°í•˜ëŠ” í”„ë¡ì‹œë¼ë©´ êµ¬ì²´ì ì¸ ìƒì„± ë°©ë²•ì„ ì•Œì•„ì•¼ í•˜ê¸° ë•Œë¬¸ì— íƒ€ê¹ƒ í´ë˜ìŠ¤ì— ëŒ€í•œ ì§ì ‘ì ì¸ ì •ë³´ë¥¼ ì•Œì•„ì•¼ í•œë‹¤.  
- ë¬¼ë¡  í”„ë¡ì‹œ íŒ¨í„´ì´ë¼ê³  í•˜ë”ë¼ë„ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ìœ„ì„í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ë„ ìˆë‹¤.   

ì•ìœ¼ë¡œëŠ” íƒ€ê¹ƒê³¼ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³ ,    
í´ë¼ì´ì–¸íŠ¸ì™€ íƒ€ê¹ƒì‚¬ì´ì— ì¡´ì¬í•˜ë©´ì„œ **ê¸°ëŠ¥ì˜ ë¶€ê°€** ë˜ëŠ” **ì ‘ê·¼ ì œì–´**ë¥¼ ë‹´ë‹¹í•˜ëŠ” ì˜¤ë¸Œì íŠ¸ë¥¼ ëª¨ë‘    **í”„ë¡ì‹œ**ë¼ê³  ë¶€ë¥´ì!!   
- ê¸°ëŠ¥ì˜ ë¶€ê°€ => ë°ì½”ë ˆì´í„° íŒ¨í„´
- ì ‘ê·¼ ì œì–´ => í”„ë¡ì‹œ íŒ¨í„´


### ğŸƒ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ
ìë°”ì—ëŠ” java.lang.reflect íŒ¨í‚¤ì§€ ì•ˆì— í”„ë¡ì‹œë¥¼ ì†ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ ì§€ì›í•´ì£¼ëŠ” í´ë˜ìŠ¤ë“¤ì´ ìˆìŒ!   
ê¸°ë³¸ì ì¸ ì•„ì´ë””ì–´ëŠ” **ëª© í”„ë ˆì„ì›Œí¬**ì™€ ë¹„ìŠ·í•˜ë‹¤.   

#### í”„ë¡ì‹œ êµ¬ì„±ê³¼ í”„ë¡ì‹œ ì‘ì„±ì˜ ë¬¸ì œì    
í”„ë¡ì‹œì˜ êµ¬ì„±   
- íƒ€ê¹ƒê³¼ ê°™ì€ ë©”ì†Œë“œë¥¼ êµ¬í˜„í•˜ê³  ìˆë‹¤ê°€ ë©”ì†Œë“œê°€ í˜¸ì¶œë˜ë©´ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ë¡œ ìœ„ì„í•œë‹¤.
- ì§€ì •ëœ ìš”ì²­ì— ëŒ€í•´ì„œëŠ” ë¶€ê°€ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œë‹¤.

íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ ìœ„í•´ ë§Œë“  UserTxëŠ” ê¸°ëŠ¥ ë¶€ê°€ë¥¼ ìœ„í•œ í”„ë¡ì‹œ!
- UserServiceTx í”„ë¡ì‹œì˜ ê¸°ëŠ¥ êµ¬ë¶„
```java
public class UserServiceTx implements UserService{
	UserService userService; // íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸
	...
		
	// ë©”ì†Œë“œ êµ¬í˜„ê³¼ ìœ„ì„
	public void add(User user){
		this.userService.add(user);
	}
	
	// ë©”ì†Œë“œ êµ¬í˜„	
	public void upgradeLevels() {
		
		// ë¶€ê°€ê¸°ëŠ¥ ìˆ˜í–‰
		TransactionStatus status = this.transactionManager.getTransaction(new DefaultTransactionDefinition());
		try{
		
			userService.upgradeLevels(); //-> ìœ„ì„
	
		// ë¶€ê°€ê¸°ëŠ¥ ìˆ˜í–‰
			this.transactionManager.commit(status);
		} catch (RuntimeException e){
			this.transactionManager.rollback(status);
			throw e;
		}
	}
}
```
UserServiceTx ì½”ë“œëŠ” UserService ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  íƒ€ê¹ƒìœ¼ë¡œ ìš”ì²­ì„ ìœ„ì„í•˜ëŠ” íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì½”ë“œë¡œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤!   

**í”„ë¡ì‹œì˜ ì—­í•  2ê°€ì§€** 
1. ìœ„ì„
2. ë¶€ê°€ì‘ì—…
   

**í”„ë¡ì‹œë¥¼ ë§Œë“¤ê¸° ë²ˆê±°ë¡œìš´ ì´ìœ  2ê°€ì§€**
1. íƒ€ê¹ƒì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìœ„ì„í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸°ê°€ ë²ˆê±°ë¡œì›€
2. ë¶€ê°€ê¸°ëŠ¥ ì½”ë“œê°€ ì¤‘ë³µë  ê°€ëŠ¥ì„±ì´ ë§ë‹¤.   

âœ… ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ í†µí•´ ì²«ë²ˆì§¸ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë‹¤!

#### ë¦¬í”Œë ‰ì…˜
ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œëŠ” ë¦¬í”Œë™ì…˜ ê¸°ëŠ¥ì„ ì´ìš©í•´ì„œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤.   
**ë¦¬í”Œë ‰ì…˜**ì€ ìë°”ì˜ ì½”ë“œ ìì²´ë¥¼ ì¶”ìƒí™”í•´ì„œ ì ‘ê·¼í•˜ë„ë¡ ë§Œë“  ê²ƒì´ë‹¤.   

- Method ì¸í„°í˜ì´ìŠ¤ ì´ìš©í•´ ë©”ì†Œë“œ í˜¸ì¶œ
```java
Method lengthMethod = String.class.getMethod("length");
```
=> ìŠ¤íŠ¸ë§ì´ ê°€ì§„ ë©”ì†Œë“œ ì¤‘ì—ì„œ "length"ë¼ëŠ” ì´ë¦„ì„ ê°–ê³  ìˆê³ , íŒŒë¼ë¯¸í„°ëŠ” ì—†ëŠ” ë©”ì†Œë“œì˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜´   

- Method ì¸í„°í˜ì´ìŠ¤ì— ì •ì˜ëœ invoke() ë©”ì†Œë“œ ì´ìš©í•´ ë©”ì†Œë“œ ì‹¤í–‰
```java
public Object invoke(Object obj, Object... args)
```
> invoke() ë©”ì†Œë“œ <br>
 ë©”ì†Œë“œë¥¼ ì‹¤í–‰ì‹œí‚¬ ëŒ€ìƒ ì˜¤ë¸Œì íŠ¸(obj)ì™€ íŒŒë¼ë¯¸í„° ëª©ë¡(args)ì„ ë°›ì•„ì„œ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•œ ë’¤ì— ê·¸ ê²°ê³¼ë¥¼ Object íƒ€ì…ìœ¼ë¡œ ëŒë ¤ì¤Œ

```java
int length = lengthMethod.invoke(name); // int length = name.length();
```
=> ì´ë¥¼ ì´ìš©í•´ length()ë©”ì†Œë“œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. 

#### í”„ë¡ì‹œ í´ë˜ìŠ¤
ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•œ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë³´ì.

- Hello ì¸í„°í˜ì´ìŠ¤
```java
interface Hello{
	String sayHello(String name);
	String sayHi(String name);
	String sayThankYou(String name);
}
```
- íƒ€ê¹ƒ í´ë˜ìŠ¤
```java
public class HelloTarget implements Hello{
	
	public String sayHello(String name){
		return "Hello " + name;
	}
	
	public String sayHi(String name){
		return "Hi " + name;
	}
	
	public String sayThankYou(String name){
		return "Thank You " + name;
	}
}
```

- í´ë¼ì´ì–¸íŠ¸ ì—­í• ì˜ í…ŒìŠ¤íŠ¸
```java
@Test
public void simpleProxy() {
	Hello hello = new HelloTarget(); // íƒ€ê¹ƒì€ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì ‘ê·¼í•˜ëŠ” ìŠµê´€ì„ ë“¤ì´ì.
	assertThat(hello.sayHello("Toby"), is("Hello Toby"));
	assertThat(hello.sayHi("Toby"), is("Hi Toby"));
	assertThat(hello.sayThankYou("Toby"), is("Thank You Toby"));
}
```

ì´ì œ Helloì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ **í”„ë¡ì‹œ**ë¥¼ ë§Œë“¤ì–´ë³´ì!   
í”„ë¡ì‹œì—ëŠ” ë°ì½”ë ˆì´í„° íŒ¨í„´ì„ ì ìš©í•´ì„œ íƒ€ê¹ƒì¸ HelloTargetì— ë¶€ê°€ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê² ë‹¤.   
- ì¶”ê°€í•  ê¸°ëŠ¥ì€ ë¦¬í„´í•˜ëŠ” ë¬¸ìë¥¼ ëª¨ë‘ ëŒ€ë¬¸ìë¡œ ë°”ê¿”ì£¼ëŠ” ê²ƒì´ë‹¤.   

- í”„ë¡ì‹œ í´ë˜ìŠ¤
```java
public class HelloUppercase implements Hello{
	Hello hello; // ìœ„ì„í•  íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸.
				 // ë‹¤ë¥¸ í”„ë¡ì‹œë¥¼ ì¶”ê°€í•  ìˆ˜ë„ ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì¸í„°í˜ì´ìŠ¤ë¡œ ì ‘ê·¼í•¨
	
	public HelloUppercase(Hello hello){
		this.hello = hello;
	}
		
	public String sayHello(String name){
		return hello.sayHello(name).toUpperCase(); // ìœ„ì„ê³¼ ë¶€ê°€ê¸°ëŠ¥ ì ìš©
	}
	
	public String sayHi(String name){
		return hello.sayHi(name).toUpperCase();
	}
	
	public String sayThankYou(String name){
		return hello.sayThankYou(name).toUpperCase();
	}
}
```

- HelloUppercase í”„ë¡ì‹œ í…ŒìŠ¤íŠ¸
```java
@Test
public void simpleProxy() {
	Hello hello = new HelloUppercase(new HelloTarget()); //í”„ë¡ì‹œë¥¼ í†µí•´ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì— ì ‘ê·¼í•˜ë„ë¡ êµ¬ì„±
	assertThat(hello.sayHello("Toby"), is("HELLO TOBY"));
	assertThat(hello.sayHi("Toby"), is("HI TOBY"));
	assertThat(hello.sayThankYou("Toby"), is("THANK YOU TOBY"));
}
```

but, ì´ í”„ë¡ì‹œëŠ” í”„ë¡ì‹œ ì ìš©ì˜ ì¼ë°˜ì ì¸ ë¬¸ì œì  2ê°€ì§€ë¥¼ ëª¨ë‘ ê°€ì§€ê³  ìˆìŒ   
1. ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•´ ìœ„ì„í•˜ë„ë¡ ì½”ë“œë¥¼ ë§Œë“¤ì–´ì•¼í•¨.
2. ë¶€ê°€ê¸°ëŠ¥ì¸ ë¦¬í„´ ê°’ì„ ëŒ€ë¬¸ìë¡œ ë°”ê¾¸ëŠ” ê¸°ëŠ¥ì´ ëª¨ë“  ë©”ì†Œë“œì— ì¤‘ë³µë˜ì–´ì„œ ë‚˜íƒ€ë‚¨.   

#### ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì ìš©
HelloUppercase ë¥¼ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•´ ë§Œë“¤ì–´ë³´ì~

- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ : í”„ë¡ì‹œ íŒ©í† ë¦¬ì— ì˜í•´ ëŸ°íƒ€ì„ ì‹œ ë‹¤ì´ë‚´ë¯¹í•˜ê²Œ ë§Œë“¤ì–´ì§€ëŠ” ì˜¤ë¸Œì íŠ¸
  - íƒ€ê¹ƒì˜ ì¸í„°í˜ì´ìŠ¤ì™€ ê°™ì€ íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ì–´ì§
  - í´ë¼ì´ì–¸íŠ¸ëŠ” ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ë¥¼ íƒ€ê¹ƒ ì¸í„°í˜ì´ìŠ¤ë¥¼ í†µí•´ ì‚¬ìš© ê°€ëŠ¥
  	- ì¸í„°í˜ì´ìŠ¤ ëª¨ë‘ êµ¬í˜„í•´ê°€ë©´ì„œ í´ë˜ìŠ¤ ì •ì˜í•˜ì§€ ì•Šì•„ë„ ë¨
  - ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œê°€ ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ëŠ” ë§Œë“¤ì–´ì£¼ì§€ë§Œ, í”„ë¡ì‹œë¡œì„œ í•„ìš”í•œ ë¶€ê°€ê¸°ëŠ¥ ì œê³µ ì½”ë“œëŠ” ì§ì ‘ ì‘ì„±í•´ì•¼ í•¨
    - ë¶€ê°€ê¸°ëŠ¥ì€ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ì™€ ë…ë¦½ì ìœ¼ë¡œ InvocationHandlerë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ì— ë‹´ìŒ

```java
public Object invoke(Object proxy, Method method, Object[] args)
```
- invoke() ë©”ì†Œë“œëŠ” ë¦¬í”Œë ‰ì…˜ì˜ Method ì¸í„°í˜ì´ìŠ¤ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ìŒ.   
- ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ ì „ë‹¬ë˜ëŠ” íŒŒë¼ë¯¸í„°ë„ argsë¡œ ë°›ìŒ
- ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ëª¨ë“  ìš”ì²­ì„ ë¦¬í”Œë ‰ì…˜ ì •ë³´ë¡œ ë³€í™˜í•´ InvocationHandler êµ¬í˜„ ì˜¤ë¸Œì íŠ¸ì˜ invoke() ë©”ì†Œë“œë¡œ ë„˜ê¸°ëŠ” ê²ƒ
- íƒ€ê¹ƒ ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œ ìš”ì²­ì´ í•˜ë‚˜ì˜ ë©”ì†Œë“œë¡œ ì§‘ì¤‘ë˜ê¸° ë•Œë¬¸ì— ì¤‘ë³µë˜ëŠ” ê¸°ëŠ¥ì„ íš¨ê³¼ì ìœ¼ë¡œ ì œê³µ

#### InvocationHandler ë¥¼ í†µí•œ ìš”ì²­ ì²˜ë¦¬ êµ¬ì¡°
1. Hello ì¸í„°í˜ì´ìŠ¤ ì œê³µí•˜ë©´ì„œ í”„ë¡ì‹œ íŒ©í† ë¦¬ì—ê²Œ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ë§Œë“¤ì–´ë‹¬ë¼ê³  ìš”ì²­í•˜ë©´
2. Hello ì¸í„°í˜ì´ìŠ¤ì˜ ëª¨ë“  ë©”ì†Œë“œë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ ìƒì„±
3. InvocationHandler ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µí•´ì£¼ë©´
4. ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œê°€ ë°›ëŠ” ëª¨ë“  ìš”ì²­ì„ InvocationHandlerì˜ invoke() ë©”ì†Œë“œë¡œ ë³´ë‚´ì¤Œ.
=> Hello ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œê°€ ì•„ë¬´ë¦¬ ë§ë”ë¼ë„ invoke() ë©”ì†Œë“œ í•˜ë‚˜ë¡œ ì²˜ë¦¬ ê°€ëŠ¥!!   

ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¡œë¶€í„° ë©”ì†Œë“œ í˜¸ì¶œ ì •ë³´ë¥¼ ë°›ì•„ì„œ ì²˜ë¦¬í•˜ëŠ” **InvocationHandler**ë¥¼ ë§Œë“¤ì–´ë³´ì~
- InvocationHandler êµ¬í˜„ í´ë˜ìŠ¤
```java
public class UppercaseHandler implements InvocationHandler {
	// ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¡œë¶€í„° ì „ë‹¬ë°›ì€ ìš”ì²­ì„ ë‹¤ì‹œ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì— ìœ„ì„í•´ì•¼í•˜ë¯€ë¡œ íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ ì£¼ì…ë°›ìŒ	
	Hello target;
	public UppercaseHandler(Hello target){ 
		this.target = target;
	}
	//
	
	public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
		String ret = (String)method.invoke(target, args); // íƒ€ê¹ƒìœ¼ë¡œ ìœ„ì„. ì¸í„°í˜ì´ìŠ¤ì˜ ë©”ì†Œë“œ í˜¸ì¶œì— ëª¨ë‘ ì ìš©ë¨
		return ret.toUpperCase(); // ë¶€ê°€ê¸°ëŠ¥ ì œê³µ
	}
}
```

ì´ì œ ì´ InvocationHandlerë¥¼ ì‚¬ìš©í•˜ê³  Hello ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ë³´ì!   
ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„±ì€ Proxy í´ë˜ìŠ¤ì˜ **newProxyInstance()** ìŠ¤íƒœí‹± íŒ©í† ë¦¬ ë©”ì†Œë“œ ì´ìš©!!!   

- í”„ë¡ì‹œ ìƒì„±
```java
Hello proxiedHello = (Hello)Proxy.newProxyInstance( //ìƒì„±ëœ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ëŠ” Hello ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  ìˆìœ¼ë¯€ë¡œ hELLOíƒ€ì…ìœ¼ë¡œ ìºìŠ¤íŒ…í•´ë„ ì•ˆì „í•˜ë‹¤.
			getClass().getClassLoader(), // ë™ì ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ í´ë˜ìŠ¤ì˜ ë¡œë”©ì— ì‚¬ìš©í•  í´ë˜ìŠ¤ ë¡œë”
			new Class[] { Hello.class }, // êµ¬í˜„í•  ì¸í„°í˜ì´ìŠ¤
			new UppercaseHandler(new HelloTarget())); // ë¶€ê°€ê¸°ëŠ¥ê³¼ ìœ„ì„ì½”ë“œë¥¼ ë‹´ì€ InvocationHandler
```

1. íŒŒë¼ë¯¸í„°1 => í´ë˜ìŠ¤ ë¡œë”ë¥¼ ì œê³µ
2. íŒŒë¼ë¯¸í„°2 => ë‹¤ë¯¸ë‚´ë¯¹ í”„ë¡ì‹œê°€ êµ¬í˜„í•´ì•¼í•  ì¸í„°í˜ì´ìŠ¤
3. íŒŒë¼ë¯¸í„°3 => ë¶€ê°€ê¸°ëŠ¥ê³¼ ìœ„ì„ ê´€ë ¨ ì½”ë“œë¥¼ ë‹´ê³  ìˆëŠ” InvocationHandler êµ¬í˜„ ì˜¤ë¸Œì íŠ¸ë¥¼ ì œê³µí•´ì•¼í•œë‹¤.   

#### ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œì˜ í™•ì¥
- í™•ì¥ëœ UppercaseHandler
```java
public class UppercaseHandler implements InvocationHandler{
	
	// ì–´ë–¤ ì¢…ë¥˜ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ íƒ€ê¹ƒì—ë„ ì ìš© ê°€ëŠ¥í•˜ë„ë¡ Object íƒ€ì…ìœ¼ë¡œ ìˆ˜ì •
	Object target;
	private UppercaseHandler(Object target){
		this.target = target;
	}
	
	public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
		
		// í˜¸ì¶œí•œ ë©”ì†Œë“œì˜ ë¦¬í„´ íƒ€ì…ì´ Stringì¸ ê²½ìš°ë§Œ ëŒ€ë¬¸ì ë³€ê²½ ê¸°ëŠ¥ ì ìš©í•˜ë„ë¡ ìˆ˜ì •
		Object ret = method.invoke(target, args);
		if(ret instanceof String){
			return ((String)ret).toUpperCase();
		}
		else{
			return ret;
		}
	}
}
```
ìœ„ì˜ ì½”ë“œì™€ ê°™ì´ ë¦¬í„´íƒ€ì… ë“±ì˜ ì •ë³´ë¥¼ ê°€ì§€ê³  ë¶€ê°€ì ì¸ ê¸°ëŠ¥ì„ ì ìš©í•  ë©”ì†Œë“œë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤.   

### ğŸƒ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•œ íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥
ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ë°©ì‹ìœ¼ë¡œ UserServiceTxë¥¼ ë³€ê²½í•´ë³´ì.   

#### íŠ¸ëœì­ì…˜ InvocationHandler
íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ ê°€ì§„ í•¸ë“¤ëŸ¬ì˜ ì½”ë“œ
```java
@Setter
public class TransactionHandler implements InvocationHandler {
	
	private Object target;
	private PlatformTransactionManager transactionManager;
	private String pattern;

	public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
		if (method.getName().startsWith(pattern)) {
			return invokeInTransaction(method, args);
		} else {
			return method.invoke(target, args);
		}
	}

	private Object invokeInTransaction(Method method, Object[] args) throws Throwable {
		TransactionStatus status = this.transactionManager.getTransaction(new DefaultTransactionDefinition());
		try {
			//íŠ¸ëœì­ì…˜ì„ ì‹œì‘í•˜ê³  íƒ€ê¹ƒ ì˜¤ë¸Œì íŠ¸ì˜ ë©”ì†Œë“œ í˜¸ì¶œ
			//ì˜ˆì™¸ê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤ë©´ ì»¤ë°‹
			Object ret = method.invoke(target, args);
			this.transactionManager.commit(status);
			return ret;
		}
		//ì˜ˆì™¸ê°€ ë°œìƒí•˜ë©´ íŠ¸ëœì­ì…˜ ë¡¤ë°± 
		catch (InvocationTargetException e) {
			this.transactionManager.rollback(status);
			throw e.getTargetException();
		}
	}
}
```

#### TransactionHandlerì™€ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì´ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸
```java
@Test
public void upgradeAllOrNothing() throws Exception {
	...
	TransactionHandler txHandler = new TransactionHandler();
	
	//íŠ¸ëœì­ì…˜ í•¸ë“¤ëŸ¬ê°€ í•„ìš”í•œ ì •ë³´ì™€ ì˜¤ë¸Œì íŠ¸ë¥¼ DIí•´ì¤€ë‹¤.
	txHandler.setTarget(testUserService);
	txHandler.setTransactionManager(trnasactionManager);
	txHandler.setPattern("upgradeLevels");
	
	//UserService ì¸í„°í˜ì´ìŠ¤ íƒ€ì…ì˜ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„±
	UserService txUserService = (UserService)Proxy.newProxyInstance(
		getClass().getClassLoader(), new Class[] { UserService.class }, txHandler);
	...
}
```

### ğŸƒ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìœ„í•œ íŒ©í† ë¦¬ ë¹ˆ
ì•ì—ì„œëŠ” ì–´ë–¤ íƒ€ê¹ƒì—ë„ ì ìš© ê°€ëŠ¥í•œ íŠ¸ëœì­ì…˜ ë¶€ê°€ê¸°ëŠ¥ì„ ë‹´ì€ TransactionHandler.   
ì´ë¥¼ ì´ìš©í•˜ëŠ” ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ UserServiceì— ì ìš©í•˜ëŠ” í…ŒìŠ¤íŠ¸ë¥¼ ë§Œë“¦.   
ì´ì œ TransactionHandlerì™€ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìŠ¤í”„ë§ì˜ DIë¥¼ í†µí•´ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ë§Œë“¤ì!   

ìŠ¤í”„ë§ì€ ë‚´ë¶€ì ìœ¼ë¡œ ë¦¬í”Œë ‰ì…˜ apië¥¼ ì´ìš©í•´ì„œ ë¹ˆ ì •ì˜ì— ë‚˜ì˜¤ëŠ” í´ë˜ìŠ¤ ì´ë¦„ì„ ê°€ì§€ê³  ë¹ˆì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.   
ë¬¸ì œëŠ” **ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸**ëŠ” ì´ëŸ°ì‹ìœ¼ë¡œ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ê°€ ìƒì„± x.   
ì‚¬ì „ì— í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ì˜ í´ë˜ìŠ¤ ì •ë³´ë¥¼ ë¯¸ë¦¬ ì•Œì•„ë‚´ì„œ ìŠ¤í”„ë§ì˜ ë¹ˆì— ì •ì˜í•  ë°©ë²•ì´ ì—†ìŒ.   

#### íŒ©í† ë¦¬ ë¹ˆ
- ì´í•´ë¥¼ ìœ„í•´ Message í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•´ì£¼ëŠ” íŒ©í† ë¦¬ ë¹ˆ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì
```java
public class MessageFactoryBean implements FactoryBean<Message> {
	String text;

	public void setText(String text){
		this.text = text;
	}

	public Message getObject() throws Exception {
		return Message.newMessage(this.text);
	}

	public Class<? extends Message> getObjectType(){
		return Message.class;
	}

	public boolean isSigleton(){
		return false;
	}
}
```

**íŒ©í† ë¦¬ë¹ˆ**ì€ ì „í˜•ì ì¸ íŒ©í† ë¦¬ ë©”ì†Œë“œë¥¼ ê°€ì§„ ì˜¤ë¸Œì íŠ¸ë‹¤.    
ìŠ¤í”„ë§ì€ FactoryBean ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ê°€ ë¹ˆì˜ í´ë˜ìŠ¤ë¡œ ì§€ì •ë˜ë©´,   
íŒ©í† ë¦¬ ë¹ˆ í´ë˜ìŠ¤ì˜ ì˜¤ë¸Œì íŠ¸ì¸ getObject() ë©”ì†Œë“œë¥¼ ì´ìš©í•´ ì˜¤ë¸Œì íŠ¸ë¥¼ ê°€ì ¸ì˜¤ê³ , ì´ë¥¼ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¡œ ì‚¬ìš©í•œë‹¤.   
ë¹ˆì˜ í´ë˜ìŠ¤ë¡œ ë“±ë¡ëœ íŒ©í† ë¦¬ ë¹ˆì€ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤.   

#### íŒ©í† ë¦¬ ë¹ˆì˜ ì„¤ì • ë°©ë²•
idì™€ class ì• íŠ¸ë¦¬ë·°íŠ¸ë¥¼ ì‚¬ìš©í•´ ë¹ˆì˜ ì•„ì´ë””ì™€ í´ë˜ìŠ¤ë¥¼ ì§€ì •   
ê·¸ë™ì•ˆì˜ ë¹ˆ ì„¤ì •ê³¼ ë‹¤ë¥¸ ì ì€ message ë¹ˆ ì˜¤ë¸Œì íŠ¸ì˜ íƒ€ì…ì´ class ì• íŠ¸ë¦¬ë·°íŠ¸ì— ì •ì˜ëœ 
MessageFactoryBeanì´ ì•„ë‹ˆë¼ Message íƒ€ì…ì´ë¼ëŠ” ê²ƒ.   

- íŒ©í† ë¦¬ ë¹ˆì„ ê°€ì ¸ì˜¤ëŠ” ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```java
@Test
public void getFactoryBean() throws Exception {
	Object factory = context.getBean("&message");
	assertThat(factory, is(MessageFactoryBean.class));
}
```

#### ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” íŒ©í† ë¦¬ ë¹ˆ
**íŒ©í† ë¦¬ ë¹ˆ** ì„ ì´ìš©í•˜ë©´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ì˜¤ë¸Œì íŠ¸ë¥¼ ìŠ¤í”„ë§ì˜ ë¹ˆìœ¼ë¡œ ë§Œë“¤ì–´ ì¤„ ìˆ˜ ìˆë‹¤.   

- ìŠ¤í”„ë§ë¹ˆ : íŒ©í† ë¦¬ ë¹ˆ, UserServiceImpl ë§Œ ë¹ˆìœ¼ë¡œ ë“±ë¡

#### íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ
```java
@Setter
public class TxProxyFactoryBean implements FactoryBean<Object> {
	
	//TransactionHandlerë¥¼ ìƒì„±í•  ë•Œ í•„ìš”
	Object target;
	PlatformTransactionManager transactionManager;
	String pattern;
	
	
	Class<?> serviceInterface; //ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ìƒì„±í•  ë•Œ í•„ìš”í•¨


	//FactoryBean ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ ë©”ì†Œë“œ
	public Object getObject() throws Exception {
		TransactionHandler txHandler = new TransactionHandler();
		txHandler.setTarget(target);
		txHandler.setTransactionManager(trnasactionManager);
		txHandler.setPattern(pattern);
		return Proxy.newProxyInstance(
			getClass().getClassLoader(), new Class[] { serviceInterface }, txHandler);
	}

	public Class<?> getObjectType() {
		return serviceInterface;
	}

	public boolean isSingleton() {
		return false; //ì‹±ê¸€í†¤ë¹ˆì´ ì•„ë‹ˆë¼ëŠ” ëœ»ì´ ì•„ë‹ˆë¼ getObejctê°€ ë§¤ë²ˆ ê°™ì€ ì˜¤ë¸Œì íŠ¸ë¥¼ ë¦¬í„´í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸
	}
}
```
=> íŠ¸ëœì­ì…˜ ì²˜ë¦¬ê°€ í•„ìš”í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê°ì²´ì— ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œë¥¼ ì ìš©.
=> íŠ¹ì • ë©”ì„œë“œ í˜¸ì¶œì‹œ ìë™ìœ¼ë¡œ íŠ¸ëœì­ì…˜ì„ ì‹œì‘, ì»¤ë°‹/ë¡¤ë°± ì²˜ë¦¬í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” íŒ©í† ë¦¬ ë¹ˆ
#### íŠ¸ëœì­ì…˜ í”„ë¡ì‹œ íŒ©í† ë¦¬ë¹ˆ í…ŒìŠ¤íŠ¸
```java
@Autowired ApplicationContext context;

@Test
@DirtiesContext
public void upgradeAllOrNothing() throws Exception {
	TestUserService testUserService = new TestUserService(users.get(3).getId());
	testUserService.setUserDao(userDao);
	testUserService.setMailSender(mailSender);

	TxProxyFactoryBean txProxyFactoryBean = context.getBean("&userService", TxProxyFactoryBean.class);
	txProxyFactoryBean.setTarget(testUserService);
	UserService txUserService = (UserService) txProxyFactoryBean.getObject();

	userDao.deleteAll();
	for (User user : users) userDao.add(user);

	try {
		txUserService.upgradeLevels();
		fail("TestUserServiceException expected");
	} catch (TestUserServiceException e){

	}

	checkLevelUpgraded(users.get(1), false);
}
```

#### í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ ë°©ì‹ì˜ ì¥ì ê³¼ í•œê³„
#### ì¥ì 

1. íƒ€ê¹ƒ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ëŠ” í´ë˜ìŠ¤ë¥¼ ì¼ì¼ì´ ë§Œë“œëŠ” ë²ˆê±°ë¡œì›€ì„ ì œê±° ê°€ëŠ¥
2. ì½”ë“œì˜ ì¤‘ë³µ ë¬¸ì œë„ í•´ê²° ê°€ëŠ¥
3. ë²ˆê±°ë¡œìš´ ë‹¤ì´ë‚´ë¯¹ í”„ë¡ì‹œ ìƒì„± ì½”ë“œë„ ì œê±° ê°€ëŠ¥

#### í•œê³„
1. í•œ ë²ˆì— ì—¬ëŸ¬ ê°œì˜ í´ë˜ìŠ¤ì— ê³µí†µì ì¸ ë¶€ê°€ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í•˜ë‹¤.
2. í•œ íƒ€ê¹ƒì— ì—¬ëŸ¬ ê°œì˜ ë¶€ê°€ê¸°ëŠ¥ì„ ì ìš©í•˜ê¸° ë¬¸ì œ
3. TransactionHandler ì˜¤ë¸Œì íŠ¸ê°€ í”„ë¡ì‹œ íŒ©í† ë¦¬ ë¹ˆ ê°œìˆ˜ë§Œí¼ ë§Œë“¤ì–´ì§„ë‹¤.
